(function(e){try{console.log("Pay with MAX loading...");var t={pwmRoot:{elementId:"MAXpwmRoot",element:null},html:{pwmButtonId:"pwm_btn",backgroundCoverId:"pwm_background_cover",loaderId:"pwm_l",bigScreenMinWidth:1e3,popup:{id:"pwm_p",xId:"pwm_p_x",messageId:"pwm_p_m",messageTitle:"pwm_p_m_tt",messageText:"pwm_p_m_tx",messageContent:"pwm_p_m_c",buttonWrapper:"pwm_p_bw",aboveButtonActionId:"pwm_p_bw_aba",buttonId:"pwm_p_bw_b",secondaryButtonId:"pwm_p_bw_sb",errorId:"pwm_p_bw_e",asteriksId:"pwm_p_bw_a",requestUserDetailsTextBoxId:"pwm_p_rud_tb_id",requestUserDetailsTextBoxPhoneNumber:"pwm_p_rud_tb_pn",timerWrapper:"pwm_p_tiate",timerBar:"pwm_p_tiate_tb",timerCounter:"pwm_p_tiate_tc"},images:{loader:{spinner:"https://digitalcdn.max.co.il/pwm/images/max_pwm_spinner.gif",max:"https://digitalcdn.max.co.il/pwm/images/max_pwm_dancingLogo.gif"}},fontface:"https://digitalcdn.max.co.il/pwm/fonts/max_regular.woff"},js:{configurationPropertyName:"data",debugPropertyName:"debug",logLevelPropertyName:"logLevel",doPropertyName:"do",buttonEnabledPropertyName:"buttonEnabled",moduleStatusPropertyName:"moduleStatus",stopAndResetTransactionPropertyName:"stopAndReset",closePopupPropertyName:"closePopup",clientIdPropertyName:"___PWM_client_id___",clientIdTimeStampPropertyName:"___PWM_client_id_stamp___",trackingSessionIdPropertyName:"___PWM_tracking_session_id___",trackingSessionTimeStampPropertyName:"___PWM_tracking_session_time_stamp___",sessionIdPropertyName:"___PWM_session_id___",sessionTimeStampPropertyName:"___PWM_session_time_stamp___"},api:{get maxUrl(){switch(r.environment){case 0:return"https://api-test.max.co.il/leumi-card/sandboxdmz";case 1:return"https://api.max-stg.co.il/max/b2btestdmz";case 2:return"https://apirt.max.co.il/max/b2b"}},getIp:{method:"GET",url:"https://api.ipify.org/?format=json",onErrorLogWarning:!0},addTransaction:{method:"POST",uri:"/paywithmaxapi/v2.0/transaction",warningOnError404:!0},cancelTransaction:{method:"DELETE",uri:"/paywithmaxapi/v2.0/transaction/TRANS_ID"},getCardStatus:{method:"GET",uri:"/paywithmaxapi/v2.0/transaction/TRANS_ID/status",ignoreError404AfterTransactionFinished:!0,startSuspendMS:5e3,requestAnyMS:1e3,lifeSpanMS:6e5,allowedFailuresSuppressionPeriods:3,suppressFailuresPeriodMs:3e3,suspendApiAfterFailuresSuppressionPeriodMs:5e3},getEncryptedCard:{method:"GET",uri:"/paywithmaxapi/v2.0/transaction/TRANS_ID/encryptedCard"},resendNotification:{method:"PUT",uri:"/paywithmaxapi/v2.0/transaction/TRANS_ID/resendNotification",ignoreError404AfterTransactionFinished:!0,onErrorLogWarning:!0,dalayBeforeResend:1e4},log:{method:"POST",get url(){switch(r.environment){case 0:case 1:return"https://mpg-stg.max-stg.co.il/MPG48/DRS21/CardHolders/PayWithMax/Log";case 2:return"https://mpg.max.co.il/MPG48/DRS21/CardHolders/PayWithMax/Log"}},get minLevel(){if(this.userDefinedMinLevel)return this.userDefinedMinLevel;switch(r.environment){case 0:return"Error";case 1:return"WARNING";case 2:return"INFO"}},set minLevel(e){this.userDefinedMinLevel=e},userDefinedMinLevel:null},ct:{method:"GET",url:"https://ct.max.co.il"}},ct:{clientIdExpirationInSeconds:63072e3,trackingSessionIdExpirationInSeconds:1800,sessionIdExpirationInSeconds:900,retriesForEvent:3},gb:{enabledInTest:!0,enabledInProd:!1,url:"https://gb.max.co.il/glassbox/detector-dom.min.js",version:"5.6.180B174",configuration:"reportEncoding=json;reportURI=https://gb.max.co.il/glassbox/reporting/D542ADA8-AAE7-BAE4-4823-38D80C9349FD/cls_report;recordErrors=true;recordScrolls=true;recordMouseMoves=true;maskBlacklistValueById=example;iframesBlackoutWhenLocationContains=*.max.co.il",domObject:"_detector",stopFunctionName:"stopRecording"},init:function(){if(t.pwmRoot.element=document.getElementById(t.pwmRoot.elementId),!t.pwmRoot.element)throw d.log.fatal("No root element was found"),new Error('No root element (with id="'+t.pwmRoot.elementId+'") was found');d.log.debug("module configuration initialized")},s:"RrTKA",sfcc:function(e,t,a){return a+=i.S,String.fromCharCode(o.at(e,t,a))}},a=function(){function e(e,t,a){var r="";if(!t.value)throw r=t.description+' function ("'+t.attributeName+'") is not set',d.log.fatal(r),new Error(r);if("function"!=typeof window[t.value])throw r=t.description+' function ("'+t.value+'") is not a function',d.log.fatal(r),new Error(r);if(d.log.info('site "'+e+'" callback ["'+t.value+'()"] function fired'+(void 0!==a?"["+JSON.stringify(a)+"]":"")),t.isReturnValue)return window[t.value](a);window[t.value](a)}var r={cardReadyCallbackFunction:{description:"Card ready",attributeName:"data-oncardreadycbfn"},cardSuccessCallbackFunction:{description:"Card ready",attributeName:"data-oncardsuccesscbfn"},onBeforeClick:{description:"On Before Click",attributeName:"data-onbeforeclickcbfn",isReturnValue:!0},logCallbackFunction:{description:"Log",attributeName:"data-onlogcbfn"},errorCallbackFunction:{description:"Error",attributeName:"data-onerrorcbfn"}};return{error:function(t){d.log.debug("site error callback fired errors "+JSON.stringify(t)),r.errorCallbackFunction.value?e("error",r.errorCallbackFunction,"string"==typeof t?new Array(t):t):d.log.error("site error callback was not set. errors ["+JSON.stringify(t)+"]")},log:function(t){d.log.info("site log callback fired logs "+JSON.stringify(t)),r.logCallbackFunction.value?e("log",r.logCallbackFunction,"string"==typeof error?new Array(t):t):d.log.warning("site log callback was was not set. logs ["+JSON.stringify(t)+"]")},cardReady:function(t){d.log.debug("site card ready callback fired data ["+JSON.stringify(t)+"]"),e("onCardReady",r.cardReadyCallbackFunction,t)},cardSuccess:function(t){d.log.debug("site card success callback fired data ["+JSON.stringify(t)+"]"),e("onCardSuccess",r.cardSuccessCallbackFunction,t)},onBeforeClick:function(){if(r.onBeforeClick.value){d.log.debug("site on before click callback fired");var t=e("onBeforeClick",r.onBeforeClick);if("boolean"==typeof t)return d.log.debug("site on click callback result ["+t+"]"),t;throw d.log.fatal("site on before click callback function returns non boolean result ["+t+"]"),new Error(r.onBeforeClick.description+' function ("'+r.onBeforeClick.attributeName+'") returns non boolean result: '+t)}return!0},init:function(){Object.keys(r).forEach(function(e){n.setPropertyValueFromAttribute(r[e])}),d.log.debug("site callBacks initialized")},s:"FqeeG",get S(){return t.s+a.s}}}(),r=function(){function e(e){var t=[];Object.keys(e).forEach(function(a){var r=e[a];void 0===r.value||void 0===r.validator||r.validator.test(r.value)||t.push('Invalid "'+r.attributeName+'"="'+r.value+'" ('+r.description+")")});var a={valid:0===t.length,errors:t};return a}var a={initMode:{description:"Initiation mode (0 - object, 1 - combined (object + user details popup), 2 - attributes, 3 - combined (attributes + user details popup))",attributeName:"data-initmode",defaultValue:0,validator:/^(0|1|2|3){1}$/,isNumber:!0,modes:{0:"object",1:"combined (object + user details popup)",2:"attributes",3:"combined (attributes + user details popup)"}},environment:{description:"Environment",attributeName:"data-env",isNumber:!0,attributeBased:!0,validator:/^(0|1)$/,notToSend:!0,notToReset:!0,defaultValue:2},ctEnabled:{description:"CT is enabled",attributeName:"data-ct-enabled",isBoolean:!0,attributeBased:!0,validator:/^(true|false)$/,notToSend:!0,notToReset:!0,defaultValue:!1},gbEnabled:{description:"gb enabled (true(default)|false)",attributeName:"data-gb-enabled",isBoolean:!0,attributeBased:!0,validator:/^(true|false)$/,notToSend:!0,notToReset:!0,defaultValue:!0},debug:{description:"Debug",attributeName:"data-debug",isBoolean:!0,attributeBased:!0,validator:/^(true|false)$/,notToSend:!0,notToReset:!0,defaultValue:!1},logLevel:{description:"log level",attributeName:"data-log-level",attributeBased:!0,validator:/^(DEBUG|INFO|WARNING|ERROR|FATAL)$/,notToSend:!0,notToReset:!0},buttonStyle:{description:"button style",attributeName:"data-button-style",attributeBased:!0,defaultValue:0,isNumber:!0,validator:/^(1|2|3|4|5)$/,notToSend:!0,notToReset:!0},language:{description:"language (eng or heb(default))",attributeName:"data-language",attributeBased:!0,defaultValue:"heb",validator:/^(eng|heb)$/,notToSend:!0,notToReset:!0},buttonEnabled:{description:"Button enaled (true[default]|false)",attributeName:"data-button-enabled",defaultValue:!0,isBoolean:!0},buttonColor:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#67EDD5"},buttonColor1:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#FFDAB9"},buttonColor2:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#DB7093"},buttonColor3:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#DDA0DD"},buttonColor4:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#FFF5EE"},buttonColor5:{description:"Button backgroung color",attributeName:"data-button-backgroundcolor",defaultValue:"#CD5C5C"},buttonHeight:{description:"Button height",attributeName:"data-button-height",defaultValue:50,isNumber:!0},buttonHeight1:{description:"Button height",attributeName:"data-button-height",defaultValue:60,isNumber:!0},buttonHeight2:{description:"Button height",attributeName:"data-button-height",defaultValue:70,isNumber:!0},buttonHeight3:{description:"Button height",attributeName:"data-button-height",defaultValue:80,isNumber:!0},buttonHeight4:{description:"Button height",attributeName:"data-button-height",defaultValue:90,isNumber:!0},buttonHeight5:{description:"Button height",attributeName:"data-button-height",defaultValue:100,isNumber:!0},buttonWidth:{description:"Button width",attributeName:"data-button-width",defaultValue:320,isNumber:!0},buttonWidth1:{description:"Button width",attributeName:"data-button-width",defaultValue:330,isNumber:!0},buttonWidth2:{description:"Button width",attributeName:"data-button-width",defaultValue:340,isNumber:!0},buttonWidth3:{description:"Button width",attributeName:"data-button-width",defaultValue:350,isNumber:!0},buttonWidth4:{description:"Button width",attributeName:"data-button-width",defaultValue:360,isNumber:!0},buttonWidth5:{description:"Button width",attributeName:"data-button-width",defaultValue:370,isNumber:!0},buttonBorderRadius:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:50,isNumber:!0},buttonBorderRadius1:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:30,isNumber:!0},buttonBorderRadius2:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:25,isNumber:!0},buttonBorderRadius3:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:20,isNumber:!0},buttonBorderRadius4:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:15,isNumber:!0},buttonBorderRadius5:{description:"Button radius",attributeName:"data-button-border-radius",defaultValue:10,isNumber:!0},buttonMinWidth:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:240,isNumber:!0},buttonMinWidth1:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:250,isNumber:!0},buttonMinWidth2:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:260,isNumber:!0},buttonMinWidth3:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:270,isNumber:!0},buttonMinWidth4:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:280,isNumber:!0},buttonMinWidth5:{description:"Button minimum width",attributeName:"data-button-min-width",defaultValue:290,isNumber:!0},buttonHtmlOrText:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x",defaultValueEng:"Pay with m_a_x",isText:!0},buttonHtmlOrText1:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x 1",defaultValueEng:"Pay with m_a_x",isText:!0},buttonHtmlOrText2:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x 2",defaultValueEng:"Pay with m_a_x",isText:!0},buttonHtmlOrText3:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x 3",defaultValueEng:"Pay with m_a_x",isText:!0},buttonHtmlOrText4:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x 4",defaultValueEng:"Pay with m_a_x",isText:!0},buttonHtmlOrText5:{description:"Button html or text",attributeName:"data-button-htmlortext",defaultValue:"לתשלום מהיר עם m_a_x 5",defaultValueEng:"Pay with m_a_x",isText:!0},buttonTextColor:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#021652"},buttonTextColor1:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#000000"},buttonTextColor2:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#0000FF"},buttonTextColor3:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#DC143C"},buttonTextColor4:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#006400"},buttonTextColor5:{description:"Button text color",attributeName:"data-button-textcolor",defaultValue:"#8B0000"},messageBeforeButtonHtmlOrText:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext"},messageBeforeButtonHtmlOrText1:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext 1"},messageBeforeButtonHtmlOrText2:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext 2"},messageBeforeButtonHtmlOrText3:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext 3"},messageBeforeButtonHtmlOrText4:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext 4"},messageBeforeButtonHtmlOrText5:{description:"Message before button html or text",attributeName:"data-button-messagebefore-htmlortext 5"},messageBeforeButtonColor:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#021652"},messageBeforeButtonColor1:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#A9A9A9"},messageBeforeButtonColor2:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#2F4F4F"},messageBeforeButtonColor3:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#B22222"},messageBeforeButtonColor4:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#00BFFF"},messageBeforeButtonColor5:{description:"Message before button color",attributeName:"data-button-messagebefore-color",defaultValue:"#228B22"},messageAfterButtonHtmlOrText:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonHtmlOrText1:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x 1",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonHtmlOrText2:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x 2",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonHtmlOrText3:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x 3",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonHtmlOrText4:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x 4",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonHtmlOrText5:{description:"Message after button html or text",attributeName:"data-button-messageafter-htmlortext",defaultValue:"תשלום מאובטח לבעלי כרטיס אשראי m_a_x 5",defaultValueEng:"Fast payment method for MAX card holders",isText:!0},messageAfterButtonColor:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#666666"},messageAfterButtonColor1:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#A9A9A9"},messageAfterButtonColor2:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#2F4F4F"},messageAfterButtonColor3:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#B22222"},messageAfterButtonColor4:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#00BFFF"},messageAfterButtonColor5:{description:"Message after button color",attributeName:"data-button-messageafter-color",defaultValue:"#228B22"},popupUserDetailsPromptTitle:{description:"Popup (user details prompt) title",attributeName:"data-popup-user-details-prompt-title",defaultValue:"",defaultValueEng:"Transaction was expired",isText:!0},popupUserDetailsPromptHtmlOrText:{description:"Popup (user details prompt) html or text",attributeName:"data-popup-user-details-prompt-htmlortext",defaultValue:"לטובת המשך תשלום מהיר ומאובטח באמצעות<br/>אפליקציית m_a_x, נא להזין פרטים",defaultValueEng:"",isText:!0},popupUserDetailsPromptAsteriks:{description:"Popup (user details prompt) asteriks",attributeName:"data-popup-user-details-prompt-asteriks",defaultValue:"בביצוע התשלום פרטיך יועברו ל-m_a_x",defaultValueEng:"",isText:!0},popupTransactionValidTitle:{description:"Popup (transaction valid) title",attributeName:"data-popup-transaction-valid-title",defaultValue:"מעולה, ככה משלמים היום קל ובטוח",defaultValueEng:"Good choice, that is how you pay from today",isText:!0},popupTransactionValidHtmlOrTextPC:{description:"Popup (transaction valid) html or text for PC",attributeName:"data-popup-transaction-valid-htmlortext-pc",defaultValue:"שלחנו ממש עכשיו לנייד שלך התראה מאפליקציית m_a_x.<br />כדי לשלם, צריך פשוט ללחוץ על ההתראה ולאשר את התשלום באפליקציה.<br />קנייה נעימה",defaultValueEng:"For easy and save payment,<br />open the notification that was sent by m_a_x appplication on your mobile device",isText:!0},popupTransactionValidHtmlOrTextMobile:{description:"Popup (transaction valid) html or text for mobile",attributeName:"data-popup-transaction-valid-htmlortext-mobile",defaultValue:"מיד נעביר אותך לאפליקציית m_a_x<br />להשלמת התשלום באופן קל ובטוח",defaultValueEng:"For easy and save payment,<br />m_a_x application will be open now",isText:!0},popupTransactionProccessingTitle:{description:"Popup (transaction proccessing) title",attributeName:"data-popup-transaction-proccessing-title",defaultValue:"מעולה, ככה משלמים היום קל ובטוח",defaultValueEng:"Good choice, that is how you pay from today",isText:!0},popupTransactionProccessingHtmlOrText:{description:"Popup (transaction proccessing) html or text",attributeName:"data-popup-transaction-proccessing-htmlortext",defaultValue:"ראינו שהזדהית בהצלחה באפליקציית m_a_x,<br />מיד נמשיך בתהליך",defaultValueEng:"For easy and save payment,<br />open the notification that was sent by m_a_x appplication on your mobile device",isText:!0},popupTransactionIsAboutToExpireTitle:{description:"Popup (transaction is about to expire) title",attributeName:"data-popup-transaction-is-about-to-expire-title",defaultValue:"הולך להסתיים הזמן",defaultValueEng:"Good choice, that is how you pay from today",isText:!0},popupTransactionIsAboutToExpireHtmlOrText:{description:"Popup (transaction is about to expire) html or text",attributeName:"data-popup-transaction-is-about-to-expire-htmlortext",defaultValue:"יש לך עוד קצת זמן להשלים את ההזמנה,<br />בתום הזמן צריך להתחיל את התהליך מחדש",defaultValueEng:"For easy and save payment,<br />open the notification that was sent by m_a_x appplication on your mobile device",isText:!0},popupTransactionExpiredTitle:{description:"Popup (transaction expired) title",attributeName:"data-popup-transaction-expired-title",defaultValue:"הסתיים הזמן לביצוע ההזמנה",defaultValueEng:"Transaction was expired",isText:!0},popupTransactionExpiredHtmlOrTextPC:{description:"Popup (transaction expired) html or text for PC",attributeName:"data-popup-transaction-expired-htmlortext-pc",defaultValue:"באפשרותך לחזור לאתר ולמלא את פרטי האשראי<br /><br /><br /><br />או",defaultValueEng:"<br />you can choose another payment method<br />or",isText:!0},popupTransactionExpiredHtmlOrTextMobile:{description:"Popup (transaction expired) html or text for mobile",attributeName:"data-popup-transaction-expired-htmlortext-mobile",defaultValue:"באפשרותך לחזור לאתר ולמלא את פרטי האשראי<br /><br />או",defaultValueEng:"<br />you can choose another payment method<br />or",isText:!0},popupTransactionNotValidTitle:{description:"Popup (transaction not valid) title",attributeName:"data-popup-transaction-not-valid-title",defaultValue:"לא נוכל להמשיך",defaultValueEng:"Ooops, something happened",isText:!0},popupTransactionNotValidHtmlOrText:{description:"Popup (transaction not valid) html or text",attributeName:"data-popup-transaction-not-valid-htmlortext",defaultValue:"לא מצאנו רישום לאפליקציית m_a_x,<br />הפעם צריך לחזור לאתר ולמלא את פרטי כרטיס האשראי",defaultValueEng:"We couldn't proccessed with the transaction<br />this time you'll need to choose another payment method",isText:!0},popupTransactionAbandonedTitle:{description:"Popup (transaction abandoned) title",attributeName:"data-popup-transaction-abandoned-title",defaultValue:"לא נוכל להמשיך",defaultValueEng:"Ooops, something happened",isText:!0},popupTransactionAbandonedHtmlOrText:{description:"Popup (transaction abandoned) html or text",attributeName:"data-popup-transaction-abandoned-htmlortext",defaultValue:"הפעם צריך לחזור לאתר ולהשלים את הרכישה באמצעות כרטיס האשראי",defaultValueEng:"We couldn't proccessed with the transaction<br />this time you'll need to choose another payment method",isText:!0},popupErrorTitle:{description:"Popup (error) title",attributeName:"data-popup-error-title",defaultValue:"משהו השתבש",defaultValueEng:"Ooops, something happened",isText:!0},popupErrorHtmlOrText:{description:"Popup (error) html or text",attributeName:"data-popup-error-htmlortext",defaultValue:"הפעם צריך לחזור לאתר ולהשלים את הרכישה באמצעות כרטיס האשראי",defaultValueEng:"We couldn't proccessed with the transaction<br />this time you'll need to choose another payment method",isText:!0}};return{get initMode(){return a.initMode.value},get isHebew(){return a.language.value===a.language.defaultValue},get isEnglish(){return a.language.value!==a.language.defaultValue},button:{get enabled(){return a.buttonEnabled.value},set enabled(e){a.buttonEnabled.value=e},get htmlOrText(){switch(a.buttonStyle.value){case 0:return a.buttonHtmlOrText.value;case 1:return a.buttonHtmlOrText1.value;case 2:return a.buttonHtmlOrText2.value;case 3:return a.buttonHtmlOrText3.value;case 4:return a.buttonHtmlOrText4.value;case 5:return a.buttonHtmlOrText5.value}},get textIsDefault(){switch(a.buttonStyle.value){case 0:return a.buttonHtmlOrText.value===a.buttonHtmlOrText.defaultValue;case 1:return a.buttonHtmlOrText1.value===a.buttonHtmlOrText1.defaultValue;case 2:return a.buttonHtmlOrText2.value===a.buttonHtmlOrText2.defaultValue;case 3:return a.buttonHtmlOrText3.value===a.buttonHtmlOrText3.defaultValue;case 4:return a.buttonHtmlOrText4.value===a.buttonHtmlOrText4.defaultValue;case 5:return a.buttonHtmlOrText5.value===a.buttonHtmlOrText5.defaultValue}},get backgroundColor(){switch(a.buttonStyle.value){case 0:return a.buttonColor.value;case 1:return a.buttonColor1.value;case 2:return a.buttonColor2.value;case 3:return a.buttonColor3.value;case 4:return a.buttonColor4.value;case 5:return a.buttonColor5.value}},get textColor(){switch(a.buttonStyle.value){case 0:return a.buttonTextColor.value;case 1:return a.buttonTextColor1.value;case 2:return a.buttonTextColor2.value;case 3:return a.buttonTextColor3.value;case 4:return a.buttonTextColor4.value;case 5:return a.buttonTextColor5.value}},get width(){switch(a.buttonStyle.value){case 0:return a.buttonWidth.value;case 1:return a.buttonWidth1.value;case 2:return a.buttonWidth2.value;case 3:return a.buttonWidth3.value;case 4:return a.buttonWidth4.value;case 5:return a.buttonWidth5.value}},get defaultWidth(){switch(a.buttonStyle.value){case 0:return a.buttonWidth.defaultValue;case 1:return a.buttonWidth1.defaultValue;case 2:return a.buttonWidth2.defaultValue;case 3:return a.buttonWidth3.defaultValue;case 4:return a.buttonWidth4.defaultValue;case 5:return a.buttonWidth5.valdefaultValueue}},get minWidth(){switch(a.buttonStyle.value){case 0:return a.buttonMinWidth.value;case 1:return a.buttonMinWidth1.value;case 2:return a.buttonMinWidth2.value;case 3:return a.buttonMinWidth3.value;case 4:return a.buttonMinWidth4.value;case 5:return a.buttonMinWidth5.value}},get height(){switch(a.buttonStyle.value){case 0:return a.buttonHeight.value;case 1:return a.buttonHeight1.value;case 2:return a.buttonHeight2.value;case 3:return a.buttonHeight3.value;case 4:return a.buttonHeight4.value;case 5:return a.buttonHeight5.value}},get borderRadius(){switch(a.buttonStyle.value){case 0:return a.buttonBorderRadius.value;case 1:return a.buttonBorderRadius1.value;case 2:return a.buttonBorderRadius2.value;case 3:return a.buttonBorderRadius3.value;case 4:return a.buttonBorderRadius4.value;case 5:return a.buttonBorderRadius5.value}},get style(){return a.buttonStyle.value}},messageBeforeButton:{get htmlOrText(){switch(a.buttonStyle.value){case 0:return a.messageBeforeButtonHtmlOrText.value;case 1:return a.messageBeforeButtonHtmlOrText1.value;case 2:return a.messageBeforeButtonHtmlOrText2.value;case 3:return a.messageBeforeButtonHtmlOrText3.value;case 4:return a.messageBeforeButtonHtmlOrText4.value;case 5:return a.messageBeforeButtonHtmlOrText5.value}},get color(){switch(a.buttonStyle.value){case 0:return a.messageBeforeButtonColor.value;case 1:return a.messageBeforeButtonColor1.value;case 2:return a.messageBeforeButtonColor2.value;case 3:return a.messageBeforeButtonColor3.value;case 4:return a.messageBeforeButtonColor4.value;case 5:return a.messageBeforeButtonColor5.value}}},messageAfterButton:{get htmlOrText(){switch(a.buttonStyle.value){case 0:return a.messageAfterButtonHtmlOrText.value;case 1:return a.messageAfterButtonHtmlOrText1.value;case 2:return a.messageAfterButtonHtmlOrText2.value;case 3:return a.messageAfterButtonHtmlOrText3.value;case 4:return a.messageAfterButtonHtmlOrText4.value;case 5:return a.messageAfterButtonHtmlOrText5.value}},get color(){switch(a.buttonStyle.value){case 0:return a.messageAfterButtonColor.value;case 1:return a.messageAfterButtonColor1.value;case 2:return a.messageAfterButtonColor2.value;case 3:return a.messageAfterButtonColor3.value;case 4:return a.messageAfterButtonColor4.value;case 5:return a.messageAfterButtonColor5.value}}},popup:{userDetailsPrompt:{get title(){return a.popupUserDetailsPromptTitle.value},get htmlOrText(){return a.popupUserDetailsPromptHtmlOrText.value},get asteriks(){return a.popupUserDetailsPromptAsteriks.value}},transactionValid:{get title(){return a.popupTransactionValidTitle.value},get htmlOrText(){return n.browserData.properties.isMobile?a.popupTransactionValidHtmlOrTextMobile.value:a.popupTransactionValidHtmlOrTextPC.value}},transactionProccessing:{get title(){return a.popupTransactionProccessingTitle.value},get htmlOrText(){return a.popupTransactionProccessingHtmlOrText.value}},transactionIsAboutToExpire:{get title(){return a.popupTransactionIsAboutToExpireTitle.value},get htmlOrText(){return a.popupTransactionIsAboutToExpireHtmlOrText.value}},transactionExpired:{get title(){return a.popupTransactionExpiredTitle.value},get htmlOrText(){return n.browserData.properties.isMobile?a.popupTransactionExpiredHtmlOrTextMobile.value:a.popupTransactionExpiredHtmlOrTextPC.value}},transactionNotValid:{get title(){return a.popupTransactionNotValidTitle.value},get htmlOrText(){return a.popupTransactionNotValidHtmlOrText.value}},transactionAbandoned:{get title(){return a.popupTransactionAbandonedTitle.value},get htmlOrText(){return a.popupTransactionAbandonedHtmlOrText.value}},error:{get title(){return a.popupErrorTitle.value},get htmlOrText(){return a.popupErrorHtmlOrText.value}}},get environment(){return a.environment.value},get ctEnabled(){return a.ctEnabled.value},get gbEnabled(){return a.gbEnabled.value},get properties(){var e={};return Object.keys(a).forEach(function(t){e[t]=a[t].value}),e},init:function(){Object.keys(a).forEach(function(e){n.setPropertyValueFromAttribute(a[e])}),a.debug.value&&d.do(["setdebug",!0]),a.logLevel.value&&(t.api.log.minLevel=a.logLevel.value);e(a);d.log.debug("html configuration initialized mode ["+a.initMode.value+" - ("+a.initMode.modes[a.initMode.value]+")]")},s:"TFLcG"}}(),o=function(){function e(e){function a(e,t){Object.keys(e).forEach(function(o){var i=e[o];switch(r.initMode){case 0:case 1:!i.attributeBased&&"object"!==i.type&&t.hasOwnProperty(i.propertyName)?i.value=n.getParsedValue(i,t[i.propertyName]):"object"===i.type&&a(i.properties,t[i.propertyName]);break;case 2:case 3:i.attributeBased||"object"===i.type?"object"===i.type&&a(i.properties):n.setPropertyValueFromAttribute(i)}})}var o="transaction configuration started";switch(r.initMode){case 0:case 1:o+="["+JSON.stringify(e)+"]";break;case 2:case 3:o+="["+t.pwmRoot.element.cloneNode(!1).outerHTML+"]"}d.log.debug(o),p(b),a(b,e),d.log.debug("transaction configuration finished")}function a(e){function t(e,a){Object.keys(e).forEach(function(r){var o=e[r];!o.attributeBased&&"object"!==o.type&&o.userDetailsCombinedInitMode&&a.hasOwnProperty(o.propertyName)?o.value=n.getParsedValue(o,a[o.propertyName]):"object"===o.type&&t(o.properties,a[o.propertyName])})}d.log.debug("set user detials called ["+JSON.stringify(e)+"]"),t(b,e);var a=c(b);a.valid?d.log.debug("set user detials successed"):d.log.error("set user detials failed")}function c(e,t,a){var o=[];Object.keys(e).forEach(function(n){var i=e[n];if(i.attributeBased||"object"===i.type){if("object"===i.type){var s=c(i.properties,i.propertyName,a);s.valid||s.errors.forEach(function(e){o.push(e)})}}else if(i.required&&(1!==r.initMode&&3!==r.initMode||(1===r.initMode||3===r.initMode)&&!i.userDetailsCombinedInitMode||(1===r.initMode||3===r.initMode)&&i.userDetailsCombinedInitMode&&a)&&(void 0===i.value||!i.validator.test(i.value))||!i.required&&void 0!==i.value&&void 0!==i.validator&&!i.validator.test(i.value))switch(r.initMode){case 0:case 1:o.push("configuration."+(t?t+".":"")+i.propertyName+(i.value?" invalid":" not set"));break;case 2:case 3:o.push('Invalid "'+i.attributeName+'"="'+i.value+'" ('+i.description+")")}});var n={valid:0===o.length,errors:o};return n}function p(e){Object.keys(e).forEach(function(t){var a=e[t];"object"!==a.type?a.hasOwnProperty("value")&&void 0!==a.value&&!a.notToReset&&delete a.value:p(a.properties)})}function m(e,t){var a={};return Object.keys(e).forEach(function(t){var r=e[t];if(!r.notToSend){var o=n.capitalizeFirstLetter(r.propertyName);"object"===r.type?a[o]=m(r.properties,t):r.hasOwnProperty("value")&&(r.doIt?a[o]=n.doIt(r.value):r.isJson?a[o]=JSON.parse(r.value):a[o]=r.value)}}),t||(a[n.capitalizeFirstLetter("actionType")]=1,a[n.capitalizeFirstLetter("transId")]=o.transId),a}var g={transId:null,inProgress:!1,isRunning:!1,cardIsReady:!1},b={clientId:{description:"Client Id",attributeName:"data-clientid",attributeBased:!0,required:!0,validator:/^[\w\.\-]+$/,notToSend:!0,notToReset:!0},paymentGatewayId:{description:"Payment Gateway Id",attributeName:"data-pgid",propertyName:"pgId",required:!0,validator:/^[\d\w\-]+$/},exportBillingAddress:{description:"Export Billing Address",attributeName:"data-eba",propertyName:"exportBillingAddress",validator:/^(true|false)$/,isBoolean:!0},clientDetails:{description:"Client details",propertyName:"clientDetails",required:!0,type:"object",properties:{id:{description:"Client details: ID",attributeName:"data-cd-id",propertyName:"id",required:!0,validator:/^\d{1,9}$/,isNumber:!0,userDetailsCombinedInitMode:!0},idType:{description:"Client details: ID type (0 - id, 1 - passport)",attributeName:"data-cd-idtype",propertyName:"idType",required:!0,validator:/^(0|1){1}$/,isNumber:!0},phoneNumber:{description:"Client details: phone number",attributeName:"data-cd-pn",propertyName:"phoneNumber",required:!0,validator:/^\d{9,10}$/,userDetailsCombinedInitMode:!0},city:{description:"Client details: city",attributeName:"data-cd-city",propertyName:"city"},street:{description:"Client details: street",attributeName:"data-cd-street",propertyName:"street"},houseNumber:{description:"Client details: house number",attributeName:"data-cd-hn",propertyName:"houseNumber",validator:/^\d{1,9}$/,isNumber:!0},apartmentNumber:{description:"Client details: apartment number",attributeName:"data-cd-an",propertyName:"apartmentNumber",validator:/^\d{1,9}$/,isNumber:!0},poBox:{description:"Client details: POBox",attributeName:"data-cd-pob",propertyName:"poBox",validator:/^\d{1,9}$/,isNumber:!0},zip:{description:"Client details: zip",attributeName:"data-cd-zip",propertyName:"zip",validator:/^\d{1,9}$/,isNumber:!0},email:{description:"Client details: email",attributeName:"data-cd-email",propertyName:"email"},firstName:{description:"Client details: first name",attributeName:"data-cd-fn",propertyName:"firstName"},lastName:{description:"Client details: last name",attributeName:"data-cd-ln",propertyName:"lastName"}}},merchantDetails:{description:"Merchant details",propertyName:"merchantDetails",required:!0,type:"object",properties:{id:{description:"Merchant details: ID",attributeName:"data-md-id",propertyName:"id",required:!0,validator:/^[\d\w\-]+$/},taxId:{description:"Merchant details: tax ID",attributeName:"data-md-taxid",propertyName:"taxId",required:!0,validator:/^\d+$/},name:{description:"Merchant details: name",attributeName:"data-md-name",propertyName:"name",required:!0,validator:/^[\w\d\-@&#\"\s\.א-ת\']+$/},url:{description:"Merchant details: url (example: http://www.test.com)",attributeName:"data-md-url",propertyName:"url",required:!0,validator:/^(http(s)?:\/\/)?[\w\.\-\/\d\%\&\?\=]+$/i},terminalNumber:{description:"Merchant details: terminal number",attributeName:"data-md-tn",propertyName:"terminalNumber",required:!0,validator:/^[\d\-]+$/,isNumber:!0},logo:{description:"Merchant details: logo",attributeName:"data-md-logo",propertyName:"logo"}}},transactionDetails:{description:"Transaction details",propertyName:"transactionDetails",required:!0,type:"object",properties:{id:{description:"Transaction details: id",attributeName:"data-td-id",propertyName:"id"},description:{description:"Transaction details: description",attributeName:"data-td-desc",propertyName:"description"},totalAmount:{description:"Transaction details: total amount",attributeName:"data-td-ta",propertyName:"totalAmount",required:!0,validator:/^\d+(\.\d+)?$/,doIt:!0,isFloat:!0},coin:{description:"Transaction details: coin",attributeName:"data-td-coin",propertyName:"coin",required:!0,validator:/^[A-Z]{3}$/i},items:{description:'Transaction details: items ([{"Name": string, "Quantity": integer, "Description": string, "TotalAmount": integer, "Price": integer)},[...],...]',attributeName:"data-td-items",propertyName:"items",validator:/^\[\s*(\{((\s*('|")(Name|Description)('|")\s*\:\s*('|")[\w\s]+('|")\s*,?)|(\s*('|")(Quantity|TotalAmount)('|")\s*\:\s*\d+\s*,?)|(\s*('|")Price('|")\s*\:\s*\d+(\.\d+)?\s*,?)){0,5}\}\s*,?)*\s*\]$/,isJson:!0},numberOfPayments:{description:"Transaction details: number of payments",attributeName:"data-td-nop",propertyName:"numberOfPayments",validator:/^\d+$/,isNumber:!0},isPaymentsByWebsite:{description:"Transaction details: payments are done by a web site",attributeName:"data-td-ipbw",propertyName:"isPaymentsByWebsite",validator:/^(true|false)$/,isBoolean:!0},firstTashPayment:{description:"Transaction details: first tash payment",attributeName:"data-td-ftp",propertyName:"firstTashPayment",validator:/^\d+(\.\d+)?$/,isFloat:!0},keyTashPayment:{description:"Transaction details: key tash payment",attributeName:"data-td-ktp",propertyName:"keyTashPayment",validator:/^\d+(\.\d+)?$/,isFloat:!0}}}};return{init:function(){switch(Object.keys(b).forEach(function(e){b[e].attributeBased&&n.setPropertyValueFromAttribute(b[e])}),r.initMode){case 0:case 1:s.preConfiguration.transaction&&(d.log.debug("transaction was configured before module was loaded"),e(s.preConfiguration.transaction),delete s.preConfiguration.transaction);break;case 2:case 3:e()}n.valitateProperties("transaction configuration failed"),d.log.debug("transaction essentials initialized")},set:e,validate:function(e){return c(b,null,e)},reset:function(e){e&&(p(b),d.log.debug("transaction data reseted")),g.inProgress=!1,g.isRunning=!1,g.cardIsReady=!1,g.transId=null,i.interact.resetExpirationTimer(),s.removeStopAndResetTransactionFunction(),r.gbEnabled&&(1===r.environment&&t.gb.enabledInTest||2===r.environment&&t.gb.enabledInProd)&&window[t.gb.domObject]&&window[t.gb.domObject][t.gb.stopFunctionName]&&"function"==typeof window[t.gb.domObject][t.gb.stopFunctionName]&&window[t.gb.domObject][t.gb.stopFunctionName](),d.log.debug("transaction reseted")},get inProgress(){return g.inProgress},set inProgress(e){g.inProgress=e},get isRunning(){return g.isRunning},set isRunning(e){g.isRunning=e},get cardIsReady(){return g.cardIsReady},set cardIsReady(e){g.cardIsReady=e},get transId(){return g.transId},set transId(e){g.transId=e},get clientId(){return b.clientId.value},get totalAmount(){return b.transactionDetails.properties.totalAmount.value},get pgId(){return b.paymentGatewayId.value},get merchantId(){return b.merchantDetails.properties.id.value},get terminalNumber(){return b.merchantDetails.properties.terminalNumber.value},get taxId(){return b.merchantDetails.properties.taxId.value},get merchantName(){return b.merchantDetails.properties.name.value},get merchantUrl(){return b.merchantDetails.properties.url.value},get userId(){return b.clientDetails.properties.id.value},get phoneNumber(){return b.clientDetails.properties.phoneNumber.value},get payload(){return m(b)},setUserDetailsCombinedInitModeData:function(){d.log.debug("set user details combined init mode data started"),i.interact.resetPopupError([t.html.popup.requestUserDetailsTextBoxId,t.html.popup.requestUserDetailsTextBoxPhoneNumber]);var e=document.getElementById(t.html.popup.requestUserDetailsTextBoxId).value,r=document.getElementById(t.html.popup.requestUserDetailsTextBoxPhoneNumber).value,o=[],n=[];if(/^\s*$/.test(e)?(u.startEvent("Pop-up details continue - ID error"),o.push(t.html.popup.requestUserDetailsTextBoxId)):b.clientDetails.properties.id.validator.test(e)||(u.startEvent("Pop-up details continue - ID error"),n.push(t.html.popup.requestUserDetailsTextBoxId)),/^\s*$/.test(r)?(u.startEvent("Pop-up details continue - phone number error"),o.push(t.html.popup.requestUserDetailsTextBoxPhoneNumber)):b.clientDetails.properties.phoneNumber.validator.test(r)||(u.startEvent("Pop-up details continue - phone number error"),n.push(t.html.popup.requestUserDetailsTextBoxPhoneNumber)),0===n.length&&0===o.length){var s={clientDetails:{id:e,phoneNumber:r}};return a(s),d.log.debug("set user details combined init mode data successed"),!0}return i.interact.setPopupError("נא למלא פרטים"+(2!==o.length?" תקינים":""),n),d.log.error("set user details combined init mode data failed."+(n.length>0?" invalid fields "+JSON.stringify(n):"")+(o.length>0?" emptyFieldsIds fields "+JSON.stringify(o):"")),!1},s:"YNdYY",get S(){return r.s+o.s},at:function(e,t,a){return a+=l.S,s.do(n.ca(e,t),n.ca(a,l.kca(t,a)))}}}(),n={generateGiud:function(){var e=window.crypto||window.msCrypto,t=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)});return d.log.debug("guid generated ["+t+"]"),t},doIt:function(e){if(!e)return null;var t=typeof e;"string"!==t&&(e=e.toString());var r=d.dosl(e,a.S);return d.log.debug("value ["+e+"] of type ["+t+'] did ["'+encodeURIComponent(r)+'"]'),encodeURIComponent(encodeURIComponent(r))},isMaxUrl:function(e){return/^https:\/\/(api(\-test)?(rt)?|mpg(\-stg)?)\.max(\-stg)?\.co.il/.test(e)},isArray:function(e){return e&&Array.isArray(e)&&e instanceof Array&&e.constructor===Array},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isString:function(e){return"string"==typeof e||e instanceof String},copyByValue:function(e){return e?JSON.parse(JSON.stringify(e)):null},setPropertyValueFromAttribute:function(e){var a=t.pwmRoot.element.hasAttribute(e.attributeName),o=t.pwmRoot.element.getAttribute(e.attributeName);if(e.required){if(!a&&!e.userDetailsCombinedInitMode)throw d.log.fatal(e.description+" attribute was not set"),new Error(e.description+' ("'+e.attributeName+'") was not configured');if(!o&&!e.userDetailsCombinedInitMode)throw d.log.fatal(e.description+" attribute value is invalid"),new Error(e.description+' ("'+e.attributeName+'") is invalid: '+o)}a?e.value=n.getParsedValue(e,o):e.isText?r.isHebew&&e.hasOwnProperty("defaultValue")?e.value=e.defaultValue:r.isEnglish&&e.hasOwnProperty("defaultValueEng")&&(e.value=e.defaultValueEng):e.hasOwnProperty("defaultValue")&&(e.value=e.defaultValue)},getParsedValue:function(e,t){return e.isNumber?/^\d+$/.test(t)?parseInt(t):null:e.isFloat?/^\d+(\.\d{1,2})?$/.test(t)?parseFloat(t):null:e.isBoolean?/^true$/i.test(t):e.isJson?JSON.stringify(t):t},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},valitateProperties:function(e,t){var r=o.validate(t);return!!r.valid||(d.log.error(e+" ["+JSON.stringify(r.errors)+"]"),a.error(r.errors),!1)},getCurrentTime:function(){var e=(new Date).getTimezoneOffset(),t=n.padValue(Math.abs(Math.floor(e/60)),2,0,"left"),a=n.padValue(Math.abs(e%60),2,0,"left"),r=e<=0?"+":"-";return new Date(Date.now()-6e4*e).toISOString().replace("T"," ").replace("Z","0000")+" "+r+t+":"+a},padValue:function(e,t,a,r){for(e=e.toString(),a=a.toString();e.length<t;)e="left"===r?a+e:e+a;return e},createCustomDimension:function(e,t){var a={};return a["d"+e]=t,a},formatExceptionErrorMessage:function(e,t){return e+" exception: name ["+t.name+"] message ["+t.message+"] stack ["+t.stack+"]"},isStorageAvailable:function(e){try{var t=window[e],a="test";return t.setItem(a,a),t.removeItem(a),!0}catch(e){return!1}},get sessionId(){function e(){window[t.js.sessionIdPropertyName]=n.generateGiud(),window[t.js.sessionTimeStampPropertyName]=(new Date).getTime(),d.log.debug("sessionId created ["+window[t.js.sessionIdPropertyName]+"] at ["+new Date(parseInt(window[t.js.sessionTimeStampPropertyName]))+"]")}if(window[t.js.sessionIdPropertyName]){var a=Math.abs(((new Date).getTime()-window[t.js.sessionTimeStampPropertyName])/1e3);a>t.ct.sessionIdExpirationInSeconds?e():window[t.js.sessionTimeStampPropertyName]=(new Date).getTime()}else e();return window[t.js.sessionIdPropertyName]},timer:{start:function(){h=new Date},stop:function(){return h?Math.abs(((new Date).getTime()-h.getTime())/1e3):0}},browserData:{properties:{os:null,browser:null,isMobile:null,userAgent:null,vw:!1,url:"",urlReferrer:"",logMessage:"",ip:"no ip detected yet"},init:function(){function e(){var e=navigator.appVersion.toLowerCase();return/win/i.test(e)?"Windows":/iPhone|iPad|iPod/i.test(e)?"iOS":/mac/i.test(e)?"Mac":/x11/i.test(e)?"UNIX":/android/i.test(e)?"Android":/CrOS/i.test(e)?"Chrome OS":/linux/i.test(e)?"Linux":"Unknown"}function t(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4))}function a(){var e={name:"",version:""},t=navigator.userAgent.match(/(opera|chrome|crios|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(t[1])){var a=/\brv[ :]+([\d\.]+)/g.exec(navigator.userAgent)||[];return{name:"IE",version:a[1]||""}}if("Chrome"===t[1]){var r=navigator.userAgent.match(/\b(OPR|Edge)\/([\d\.]+)/);if(null!=r)return{name:r[1].replace("OPR","Opera"),version:r[2]}}"CriOS"===t[1]&&(t[1]="Chrome"),t=t[2]?[t[1],t[2]]:[navigator.version.replace(/[^a-z0-9\.\s]+/gim,"").replace(/\s+/gim,"_"),navigator.appName,"-?"];var o=navigator.userAgent.match(/version\/([\d\.]+)/i);return null!=o&&t.splice(1,1,o[1]),e.name=t[0],e.version=t[1],e}function o(){var e={messenger:/\bFB[\w_]+\/(Messenger|MESSENGER)/,facebook:/\bFB[\w_]+\//,twitter:/\bTwitter/i,line:/\bLine\//i,wechat:/\bMicroMessenger\//i,puffin:/\bPuffin/i,miui:/\bMiuiBrowser\//i,instagram:/\bInstagram/i,tiktok:/\bmusical__ly/i,common:/\bWebView/i,androidVW:/Android.*(wv|\.0\.0\.0)/i},t={isVW:!1};return Object.keys(e).forEach(function(a){e[a].test(navigator.userAgent)&&(t={isVW:!0,appName:a})}),t}n.browserData.properties.os=e(),n.browserData.properties.browser=a(),n.browserData.properties.isMobile=t(),n.browserData.properties.userAgent=navigator.userAgent||navigator.vendor||window.opera,n.browserData.properties.vw=o(),n.browserData.properties.url=window.location.href,n.browserData.properties.urlReferrer=document.referrer,n.browserData.properties.logMessage="user's software/hardware: browser ["+n.browserData.properties.browser.name+"], version ["+n.browserData.properties.browser.version+"], vw ["+(n.browserData.properties.vw.isVW?n.browserData.properties.vw.appName:"false")+"] platform ["+(n.browserData.properties.isMobile?"mobile":"pc")+"], os ["+n.browserData.properties.os+"]",0!==r.environment&&"IE"!==n.browserData.properties.browser.name&&l.getIp().then(function(e){n.browserData.properties.ip=e,d.log.debug("user's ip ["+n.browserData.properties.ip+"]")}),d.log.debug("browser data initialized")}},dom:function(){function e(){if(window.FontFace&&document.fonts){var e=new FontFace("max","url("+t.html.fontface+') format("truetype")');document.fonts.add(e)}else{var a=document.createElement("style");a.type="text/css",a.id="maxFont",t.pwmRoot.element.appendChild(a);var r='@font-face { font-family: max; src: url("'+t.html.fontface+'") format("truetype")}';a.styleSheet?a.styleSheet.cssText=r:a.appendChild(document.createTextNode(r))}}function a(e,t,a){void 0!==document.addEventListener&&(e.addEventListener(t,a,!1),window.onbeforeunload=function(){e.removeEventListener(t,a,!1)})}function r(e,t,a){void 0!==document.addEventListener&&e.removeEventListener(t,a,!1)}return{init:function(t,r){e(),a(window,"focus",r),a(window,"blur",t),void 0!==document.hidden&&a(window,"visibilitychange",function(e){document.hidden?t(e):r(e)}),d.log.debug("dom settings initialized (font + event listeners)")},setElementPublicAction:function(e,t){e.setAttribute("data-pwm-action",t),a(e,"click",___pwm.do)},removeElementPublicAction:function(e){e.removeAttribute("data-pwm-action"),r(e,"click",___pwm.do)}}}(),gb:{init:function(){if(r.gbEnabled&&(1===r.environment&&t.gb.enabledInTest||2===r.environment&&t.gb.enabledInProd)){var e=document.createElement("script");e.async="async",e.type="text/javascript",e.charset="undefined",e.setAttribute("data-clsconfig",t.gb.configuration.replace("BUTTON_ID",t.pwmRoot.elementId).replace("POPUP_OVERLAY",t.html.popup.id)),e.src=t.gb.url+"?rev="+t.gb.version,e.onload=function(){d.log.debug("gb script loaded")},e.onerror=function(){d.log.error("gb script failed to load")},document.head.appendChild(e),d.log.debug("gb script set")}else d.log.warning("gb disabled env ["+r.environment+"] flag test ["+t.gb.enabledInTest.toString()+"] flag prod ["+t.gb.enabledInProd.toString()+"] attribute ["+r.gbEnabled+"]")}},ca:function(e,t){return e.charCodeAt(t)},s:"yOlvE"},i=(f=null,y={get screenHeight(){return window.innerHeight},get screenWidth(){return window.innerWidth},get isSmallScreen(){return y.screenWidth<t.html.bigScreenMinWidth},get xButton(){return document.getElementById(t.html.popup.xId)},get message(){return document.getElementById(t.html.popup.messageId)},get title(){return document.getElementById(t.html.popup.messageTitle)},get text(){return document.getElementById(t.html.popup.messageText)},get messageContent(){return document.getElementById(t.html.popup.messageContent)},get buttonWrapper(){return document.getElementById(t.html.popup.buttonWrapper)},get aboveButtonAction(){return document.getElementById(t.html.popup.aboveButtonActionId)},get button(){return document.getElementById(t.html.popup.buttonId)},get secondaryButton(){return document.getElementById(t.html.popup.secondaryButtonId)},get asteriks(){return document.getElementById(t.html.popup.asteriksId)},get timerWrapper(){return document.getElementById(t.html.popup.timerWrapper)},removeElement:function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},validateGeniuineBaseElement:function(e){var t=e.getAttribute("data-sid");return t===n.sessionId||(d.log.warning("removing not origonal element ["+e.id+"]"),e.remove(),!1)},resizePop:function(){var e=document.getElementById(t.html.popup.id);if(e)if(e.style.height=null,e.clientHeight>y.screenHeight&&(e.style.height="100%"),e.clientWidth>y.screenWidth)e.setAttribute("data-original-popup-width",e.clientWidth),e.style.width="100%";else{var a=e.getAttribute("data-original-popup-width");a&&(e.style.width=a+"px",e.removeAttribute("data-original-popup-width"))}d.log.debug("popup resized width ["+e.clientWidth+"] height ["+e.clientHeight+"]")}},{create:{pwmButton:{messageBefore:function(){var e=document.createElement("div");e.innerHTML=r.messageBeforeButton.htmlOrText,e.style.direction="rtl",e.style.fontFamily='"max", Fallback, sans-serif',e.style.letterSpacing="-0.07px",e.style.fontSize="16px",e.style.textAlign="center",e.style.color=r.messageBeforeButton.color,e.style.cursor="text",e.style.marginBottom="5px",e.style.display="block",e.style.margin="auto",e.style.maxWidth=r.button.width+"px",e.style.minWidth=r.button.minWidth+"px",r.button.width!==r.button.defaultWidth&&(e.style.width=r.button.width+"px"),t.pwmRoot.element.appendChild(e),d.log.debug("message before button built")},messageAfter:function(){var e=document.createElement("div");e.innerHTML=r.messageAfterButton.htmlOrText,e.style.direction="rtl",e.style.fontFamily='"max", Fallback, sans-serif',e.style.letterSpacing="-0.07px",e.style.fontSize="15px",e.style.textAlign="center",e.style.color=r.messageAfterButton.color,e.style.cursor="text",e.style.marginTop="5px",e.style.display="block",e.style.margin="auto",e.style.maxWidth=r.button.width+"px",e.style.minWidth=r.button.minWidth+"px",r.button.width!==r.button.defaultWidth&&(e.style.width=r.button.width+"px"),t.pwmRoot.element.appendChild(e),d.log.debug("message after button built")},button:function(){var e=document.createElement("div");if(e.id=t.html.pwmButtonId,e.style.direction="rtl",e.style.fontFamily='"max", Fallback, sans-serif',e.style.letterSpacing="-0.07px",e.style.fontSize="22px",e.style.height=r.button.height+"px",e.style.verticalAlign="middle",e.style.lineHeight=r.button.height-(r.button.height/2-22)+"px",e.style.textAlign="center",e.style.borderRadius=r.button.borderRadius+"px",e.style.background=r.button.backgroundColor,e.style.color=r.button.textColor,e.style.maxWidth=r.button.width+"px",e.style.minWidth=r.button.minWidth+"px",r.button.width!==r.button.defaultWidth&&(e.style.width=r.button.width+"px"),e.style.display="block",e.style.margin="auto",e.style.cursor="pointer",n.dom.setElementPublicAction(e,"pay"),e.innerHTML=r.button.htmlOrText,!n.browserData.properties.isMobile){function a(){s.style.borderWidth="0px 3px 3px 0px",s.style.marginRight="10px"}function o(){s.style.borderWidth="0",s.style.marginRight="0"}e.onmouseover=a,e.onmouseout=o}if(t.pwmRoot.element.appendChild(e),!n.browserData.properties.isMobile){var s=document.createElement("span");s.style.border="solid",s.style.borderColor=r.button.textColor,s.style.transform="rotate(135deg)",s.style.display="inline-block",s.style.width="0",s.style.height="0",s.style.padding="4px",s.style.borderWidth="0",s.style.marginRight="0",s.style.transition="margin 0.3s ease",e.appendChild(s)}d.log.debug("pwm button built"),r.button.enabled||(d.log.debug("pwm button disabled"),i.interact.pwmButton.disable())}},popup:{background:function(){var e=document.getElementById(t.html.backgroundCoverId);e&&y.validateGeniuineBaseElement(e)||(e=document.createElement("div"),e.id=t.html.backgroundCoverId,e.setAttribute("data-sid",n.sessionId),e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",e.style.background="rgba(0, 0, 0, 0.6)",e.style.zIndex=2147483600,document.body.appendChild(e),d.log.debug("popup background built"))},popupLayout:function(){var e=document.getElementById(t.html.popup.id);if(!e||!y.validateGeniuineBaseElement(e)){e=document.createElement("div"),e.id=t.html.popup.id,e.setAttribute("data-sid",n.sessionId),e.style.direction="rtl",e.style.background="#FFFFFF",e.style.borderRadius="5px",e.style.padding="50px 0 20px",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.overflowY="auto",e.style.zIndex=2147483601,y.isSmallScreen?(e.style.minWidth="335px",e.style.minHeight="400px"):(e.style.minWidth="740px",e.style.minHeight="500px"),document.getElementById(t.html.backgroundCoverId).appendChild(e);var a=document.createElement("div");a.id=t.html.popup.xId,a.innerText="+",a.style.fontFamily="serif",a.style.fontSize="24px",a.style.height="18px",a.style.width="18px",a.style.transform="rotate(45deg)",a.style.position="absolute",a.style.top="10px",a.style.left="10px",a.style.lineHeight="18px",a.style.textAlign="center",a.style.cursor="pointer",a.style.userSelect="none",n.dom.setElementPublicAction(a,"closePopup"),e.appendChild(a);var o=document.createElement("div");o.id=t.html.popup.messageId,o.style.margin="0 auto",o.style.width="100%",o.style.zIndex=2147483602,e.appendChild(o);var i=document.createElement("div");i.id=t.html.popup.messageTitle,i.style.textAlign="center",i.style.fontFamily="max, Fallback, sans-serif",i.style.color="#000000",i.style.fontWeight="bold",i.style.padding="0 10px",i.style.marginBottom="40px",i.style.zIndex=2147483603,y.isSmallScreen?(i.style.fontSize="22px",i.style.letterSpacing="-0.07px"):(i.style.fontSize="24px",i.style.letterSpacing="-0.25px"),o.appendChild(i);var s=document.createElement("div");s.id=t.html.popup.messageText,s.style.fontFamily="max, Fallback, sans-serif",s.style.textAlign="center",s.style.color="#000000",s.style.padding="0 10px",s.style.zIndex=2147483603,y.isSmallScreen?(s.style.fontSize="18px",s.style.letterSpacing="-0.07px"):(s.style.fontSize="20px",s.style.letterSpacing="-0.25px"),o.appendChild(s);var l=document.createElement("div");l.id=t.html.popup.messageContent,l.style.textAlign="center",l.style.margin="0 auto",l.style.width="100%",l.style.zIndex=2147483603,y.isSmallScreen?l.style.marginTop="50px":l.style.marginTop="80px",o.appendChild(l);var u=document.createElement("div");u.id=t.html.popup.buttonWrapper,u.style.margin="0 auto 0",u.style.width="100%",u.style.zIndex=2147483602,e.appendChild(u);var c=document.createElement("div");c.id=t.html.popup.aboveButtonActionId,c.style.fontFamily="max, Fallback, sans-serif",c.style.textAlign="center",c.style.margin="0 auto",c.style.width="100%",c.style.height="24px",c.style.margin="0 auto 0",y.isSmallScreen?(c.style.fontSize="14px",c.style.letterSpacing="-0.07px"):(c.style.fontSize="16px",c.style.letterSpacing="-0.25px"),c.style.zIndex=2147483604,u.appendChild(c);var p=document.createElement("div");p.id=t.html.popup.buttonId,p.style.direction="rtl",p.style.fontFamily="max, Fallback, sans-serif",p.style.textAlign="center",p.style.cursor="pointer",p.style.border="none",p.style.height="51px",p.style.width="267px",p.style.borderRadius="26px",p.style.background="#67EED5",p.style.color="#021652",n.dom.setElementPublicAction(p,"closePopup"),p.style.zIndex=2147483603,p.style.verticalAlign="middle",p.style.margin="0 auto 0",p.innerHTML="",y.isSmallScreen?(p.style.letterSpacing="-0.07px",p.style.fontSize="18px",p.style.lineHeight="44.5px"):(p.style.letterSpacing="-0.25px",p.style.fontSize="20px",p.style.lineHeight="46.5px"),u.appendChild(p);var m=document.createElement("button");if(m.id=t.html.popup.secondaryButtonId,m.style.direction="rtl",m.style.fontFamily="max, Fallback, sans-serif",m.style.textAlign="center",m.style.cursor="pointer",m.style.border="none",m.style.height="51px",m.style.width="267px",m.style.borderRadius="26px",m.style.background="#FFFFFF",m.style.color="#479BA2",n.dom.setElementPublicAction(m,"closePopup"),m.style.zIndex=2147483603,p.style.margin="0 auto 0",m.innerHTML="",y.isSmallScreen?(m.style.letterSpacing="-0.07px",m.style.fontSize="16px"):(m.style.letterSpacing="-0.25px",m.style.fontSize="18px",m.style.bottom="50px"),u.appendChild(m),1===r.initMode||3===r.initMode){var g=document.createElement("div");g.id=t.html.popup.asteriksId,g.style.fontFamily="max, Fallback, sans-serif",g.style.textAlign="center",g.style.margin="0 auto",g.style.width="100%",g.style.height="24px",y.isSmallScreen?(g.style.fontSize="14px",g.style.letterSpacing="-0.07px"):(g.style.fontSize="16px",g.style.letterSpacing="-0.25px"),g.style.zIndex=2147483604,u.appendChild(g);var b=document.createElement("div");b.id=t.html.popup.errorId,b.style.fontFamily="max, Fallback, sans-serif",b.style.textAlign="center",b.style.width="100%",b.style.height="24px",b.style.color="red",y.isSmallScreen?(b.style.fontSize="14px",b.style.letterSpacing="-0.07px"):(b.style.fontSize="16px",b.style.letterSpacing="-0.25px"),b.style.zIndex=2147483604,u.appendChild(b)}var f=document.createElement("div");f.id=t.html.popup.timerWrapper,u.appendChild(f),d.log.debug("popup built")}},loader:function(){var e=document.getElementById(t.html.loaderId);e&&y.validateGeniuineBaseElement(e)||(e=document.createElement("div"),e.id=t.html.loaderId,e.setAttribute("data-sid",n.sessionId),e.style.display="block",e.style.content="",e.style.background="url("+t.html.images.loader.spinner+")",e.style.backgroundSize="cover",e.style.width="150px",e.style.height="150px",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.pointerEvents="none",e.style.zIndex=2147483601,document.getElementById(t.html.backgroundCoverId).appendChild(e),d.log.debug("loader built"))}},message:function(e){function a(){function e(e){if(13===e.keyCode)return e.preventDefault(),___pwm.do("setUserDetails"),!1}r.popup.userDetailsPrompt.title&&i.interact.setElementTextAndAction(y.title,r.popup.userDetailsPrompt.title),r.popup.userDetailsPrompt.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.userDetailsPrompt.htmlOrText),y.buttonWrapper.style.marginTop=y.isSmallScreen?"50px":"135px";var a=document.createElement("input");a.type="tel",a.id=t.html.popup.requestUserDetailsTextBoxId,a.placeholder="מספר הזהות שלך",a.style.border="1px grey solid",a.style.borderRadius="2px",a.style.textAlign="center",a.style.margin="10px",a.style.fontSize="20px",a.maxLength=9,a.onkeypress=e,y.isSmallScreen?(a.style.width="85%",a.style.maxWidth="420px",a.style.height="50px"):(a.style.width="300px",a.style.height="50px"),o.userId&&(a.value=o.userId),y.messageContent.appendChild(a);var n=document.createElement("input");n.type="tel",n.id=t.html.popup.requestUserDetailsTextBoxPhoneNumber,n.placeholder="מס' הטלפון הנייד שלך",n.style.border="1px grey solid",n.style.borderRadius="2px",n.style.textAlign="center",n.style.margin="10px",n.style.fontSize="20px",n.maxLength=10,n.onkeypress=e,y.isSmallScreen?(n.style.width="85%",n.style.maxWidth="420px",n.style.height="50px"):(n.style.width="300px",n.style.height="50px"),o.userId&&(n.value=o.phoneNumber),y.messageContent.appendChild(n),y.messageContent.style.display="block",i.interact.setElementTextAndAction(y.button,"המשך","setUserDetails"),y.button.style.background="#67EDD5",y.button.style.color="#021652",r.popup.userDetailsPrompt.asteriks&&i.interact.setElementTextAndAction(y.asteriks,r.popup.userDetailsPrompt.asteriks)}function s(){n.dom.setElementPublicAction(y.xButton,"cancel"),r.popup.transactionValid.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionValid.title),r.popup.transactionValid.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionValid.htmlOrText),n.browserData.properties.isMobile||(i.interact.setElementTextAndAction(y.aboveButtonAction,"לא קיבלתי את ההתראה"),i.interact.setElementTextAndAction(y.button,"שלחו לי ב SMS","resendNotification"))}function l(){n.dom.removeElementPublicAction(y.xButton),y.xButton.style.display="none",r.popup.transactionProccessing.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionProccessing.title),r.popup.transactionProccessing.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionProccessing.htmlOrText);var e=document.createElement("div");e.style.display="block",e.style.content="",e.style.background="url("+t.html.images.loader.max+")",e.style.backgroundSize="cover",e.style.zIndex=2147483603,y.isSmallScreen?(e.style.width="70px",e.style.height="70px",e.style.margin="20px auto"):(e.style.width="100px",e.style.height="100px",e.style.margin="25px auto"),y.messageContent.appendChild(e),y.messageContent.style.display="block"}function c(){n.dom.setElementPublicAction(y.xButton,"cancel"),r.popup.transactionIsAboutToExpire.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionIsAboutToExpire.title),r.popup.transactionIsAboutToExpire.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionIsAboutToExpire.htmlOrText);var e=document.createElement("div");e.style.display="inline-block",e.style.width="100%",y.timerWrapper.appendChild(e);var a=document.createElement("div");a.id=t.html.popup.timerBar,a.style.width="100%",a.style.height="3px",a.style.float="right",a.style.backgroundColor="#479BA2",e.appendChild(a);var o=document.createElement("div");o.style.display="inline-block",o.style.width="100%",o.style.textAlign="center",y.timerWrapper.appendChild(o);var s=document.createElement("span");s.style.fontFamily="max, Fallback, sans-serif",s.innerText="הזמן שנותר ",y.isSmallScreen?(s.style.fontSize="16px",s.style.letterSpacing="-0.07px"):(s.style.fontSize="18px",s.style.letterSpacing="-0.25px"),o.appendChild(s);var l=document.createElement("span");l.id=t.html.popup.timerCounter,l.style.fontFamily="max, Fallback, sans-serif",l.innerText="01:00",y.isSmallScreen?(l.style.fontSize="16px",l.style.letterSpacing="-0.07px"):(l.style.fontSize="18px",l.style.letterSpacing="-0.25px"),o.appendChild(l),n.browserData.properties.isMobile||(i.interact.setElementTextAndAction(y.aboveButtonAction,"לא קיבלתי את ההודעה"),i.interact.setElementTextAndAction(y.button,"שלחו לי ב SMS","resendNotification")),y.buttonWrapper.style.marginTop=n.browserData.properties.isMobile?"150px":"170px",y.timerWrapper.style.display="block"}function p(){r.popup.transactionExpired.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionExpired.title),r.popup.transactionExpired.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionExpired.htmlOrText),i.interact.setElementTextAndAction(y.button,"להתחיל מחדש","pay"),y.buttonWrapper.style.marginTop=y.isSmallScreen?"50px":"110px"}function m(){r.popup.transactionNotValid.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionNotValid.title),r.popup.transactionNotValid.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionNotValid.htmlOrText),i.interact.setElementTextAndAction(y.button,"אוקי","closePopup"),y.buttonWrapper.style.marginTop=n.browserData.properties.isMobile?"90px":"220px"}function g(){r.popup.transactionAbandoned.title&&i.interact.setElementTextAndAction(y.title,r.popup.transactionAbandoned.title),r.popup.transactionAbandoned.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.transactionAbandoned.htmlOrText),i.interact.setElementTextAndAction(y.button,"אוקי","closePopup"),y.buttonWrapper.style.marginTop=n.browserData.properties.isMobile?"140px":"230px"}function b(){r.popup.error.title&&i.interact.setElementTextAndAction(y.title,r.popup.error.title),r.popup.error.htmlOrText&&i.interact.setElementTextAndAction(y.text,r.popup.error.htmlOrText),i.interact.setElementTextAndAction(y.button,"אוקי","closePopup"),y.buttonWrapper.style.marginTop=n.browserData.properties.isMobile?"140px":"230px"}if(null===i.currentMessageType&&i.remove.loader(),i.create.popup.background(),i.create.popup.popupLayout(),i.currentMessageType!==e){switch(i.interact.resetPopupButtonStyle(),e){case i.messageType.userDetailsPrompt:a(),u.startEvent("Pop-up "+e+" appeared");break;case i.messageType.transactionValid:s(),u.startEvent("Pop-up "+e+" appeared");break;case i.messageType.transactionIsAboutToExpire:c(),u.startEvent("Pop-up "+e+" appeared");break;case i.messageType.transactionProccessing:l(),u.endEvent("Pop-up "+e+" appeared");break;case i.messageType.transactionExpired:p(),u.endEvent("Pop-up "+e+" appeared");break;case i.messageType.transactionNotValid:switch(i.currentMessageType){case i.messageType.transactionValid:case i.messageType.transactionIsAboutToExpire:case i.messageType.transactionProccessing:u.endEvent("Pop-up "+e+" appeared");break;default:u.startEvent("Pop-up "+e+" appeared")}m();break;case i.messageType.transactionAbandoned:u.startEvent("Pop-up "+e+" appeared"),g();break;case i.messageType.transactionError:switch(i.currentMessageType){case i.messageType.transactionValid:case i.messageType.transactionIsAboutToExpire:case i.messageType.transactionProccessing:u.endEvent("Pop-up "+e+" appeared");break;default:u.startEvent("Pop-up "+e+" appeared")}b()}d.log.info(e.toLowerCase()+" message built"),i.currentMessageType=e}}},remove:{backgroundCover:function(){y.removeElement(t.html.backgroundCoverId),i.currentMessageType=null,d.log.debug("popup background removed")},loader:function(){y.removeElement(t.html.loaderId),d.log.debug("loader removed")},popup:function(){y.removeElement(t.html.popup.id),i.currentMessageType=null,d.log.debug("popup removed")}},interact:{pwmButton:{enable:function(){var e=document.getElementById("pwm_btn");e.style.filter=null,e.style.cursor="pointer",e.disabled=null,r.button.enabled=!0},disable:function(){var e=document.getElementById("pwm_btn");e.style.filter="grayscale(100%)",e.style.cursor="not-allowed",e.disabled="disabled",r.button.enabled=!1}},resetPopupButtonStyle:function(){y.xButton.style.display="block",n.dom.setElementPublicAction(y.xButton,"closePopup"),y.title="",y.title.style.display="none",y.text="",y.text.style.display="none",y.messageContent.innerHTML="",y.messageContent.style.display="none",y.messageContent.style.marginTop=y.isSmallScreen?"50px":"80px",y.aboveButtonAction.style.display="none",y.aboveButtonAction.style.innerHTML="",y.buttonWrapper.style.marginTop=y.isSmallScreen?"76px":"176px",y.button.style.display="none",y.button.innerHTML="",y.button.style.background="#67EED5",y.button.style.color="#021652",n.dom.removeElementPublicAction(y.button),y.secondaryButton.style.display="none",y.secondaryButton.innerHTML="",n.dom.removeElementPublicAction(y.secondaryButton),1!==r.initMode&&3!==r.initMode||(y.asteriks.style.display="none"),i.currentMessageType===i.messageType.transactionIsAboutToExpire&&i.interact.resetExpirationTimer(),y.timerWrapper.style.display="none"},setElementTextAndAction:function(e,t,a){e.innerHTML=t,e.style.display="block",a&&n.dom.setElementPublicAction(e,a)},setPopupError:function(e,a){a&&a.length>0&&a.forEach(function(e){var t=document.getElementById(e);t.hasAttribute("data-original-textbox-bordercolor")||t.setAttribute("data-original-textbox-bordercolor",t.style.borderColor),t.style.borderColor="red"}),document.getElementById(t.html.popup.errorId).innerText=e},resetPopupError:function(e){e&&e.length>0&&e.forEach(function(e){var t=document.getElementById(e);t.hasAttribute("data-original-textbox-bordercolor")&&(t.style.borderColor=t.getAttribute("data-original-textbox-bordercolor"),t.removeAttribute("data-original-textbox-bordercolor"))}),i.interact.setPopupError("")},setExpirationTimer:function(e){if(!f){var a=e,r=e;f=setInterval(function(){r--,document.getElementById(t.html.popup.timerBar).style.width=r/a*100+"%",document.getElementById(t.html.popup.timerCounter).innerText=((r-r%60)/60).toString().padStart(2,"0")+":"+(r%60).toString().padStart(2,"0")},1e3)}},resendNotification:{sending:function(){i.interact.setElementTextAndAction(y.aboveButtonAction,"ברגעים אלה נשלחת אלייך הודעת SMS..."),y.button.style.display="none",y.buttonWrapper.style.marginTop=y.buttonWrapper.style.marginTop.replace(/\D/g,"")-0+25+"px"},sent:function(){i.interact.setElementTextAndAction(y.aboveButtonAction,"עדיין לא קיבלתי"),i.interact.setElementTextAndAction(y.button,"שלחו לי ב SMS שוב","resendNotification"),y.button.style.display="block",y.buttonWrapper.style.marginTop=y.buttonWrapper.style.marginTop.replace(/\D/g,"")-25+"px"}},resetExpirationTimer:function(){f&&(clearInterval(f),f=null)}},resetPwmRoot:function(){t.pwmRoot.element.innerHTML=""},messageType:{userDetailsPrompt:"User details prompt",transactionValid:"Continue with max app",transactionProccessing:"Successful Identification",transactionIsAboutToExpire:"Continue with max app expires",transactionExpired:"Transaction expired",transactionNotValid:"Transaction not valid",transactionAbandoned:"Transaction abandoned",transactionError:"General error"},currentMessageType:null,init:function(){i.resetPwmRoot(),r.messageBeforeButton.htmlOrText&&i.create.pwmButton.messageBefore(),i.create.pwmButton.button(),r.messageAfterButton.htmlOrText&&i.create.pwmButton.messageAfter(),u.startEvent("Show Pay with max Button"),d.log.info("button shown ("+n.browserData.properties.logMessage+")")},s:"iNRMO",get S(){return n.s+i.s}}),s={startTransaction:function(){o.inProgress=!0,o.transId=n.generateGiud(),l.addTransaction()},payWithMaxButtonClick:function(){if(d.log.debug("pwm button clicked"),r.button.enabled)if(o.inProgress)d.log.warning("pwm button clicked - transation in proccess");else{switch(u.startEvent("Press Pay with max Button"),i.remove.backgroundCover(),r.initMode){case 0:d.log.info("pwm button clicked");break;case 1:return d.log.info("pwm button clicked - requesting user details"),i.create.popup.background(),i.create.popup.popupLayout(),void i.create.message(i.messageType.userDetailsPrompt);case 2:d.log.info("pwm button clicked - setting transation data"),o.set();break;case 3:return d.log.info("pwm button clicked - setting transation data and requesting user details"),o.set(),i.create.popup.background(),i.create.popup.popupLayout(),void i.create.message(i.messageType.userDetailsPrompt)}if(a.onBeforeClick())return n.valitateProperties("pwm button clicked - validation failed")?(i.create.popup.background(),i.create.popup.loader(),void s.startTransaction()):(u.setDimensionsForNextEvent(n.createCustomDimension(15,"Data validation failed")),void i.create.message(i.messageType.transactionError));d.log.warning("site's onbefore callback failed")}else d.log.warning("pwm button clicked - button disabled")},setUserDetailsButtonClick:function(e){if(d.log.debug("set user details button clicked"),r.button.enabled){if(o.inProgress)d.log.warning("set user details button clicked - transation in proccess");else if(o.setUserDetailsCombinedInitModeData()&&(d.log.info("set user details button clicked"),u.startEvent("Pop-up details continue - OK"),a.onBeforeClick()))return n.valitateProperties("set user details button clicked - transaction data validation failed",!0)?(i.remove.popup(),i.create.popup.loader(),void s.startTransaction()):(u.setDimensionsForNextEvent(n.createCustomDimension(15,"Data validation failed")),void i.create.message(i.messageType.transactionError))}else d.log.warning("set user details button clicked - button disabled")},resendNotificationButtonClick:function(){d.log.info("resend notification button clicked"),o.inProgress&&(u.startEvent("Press resend notification button"),i.interact.resendNotification.sending(),l.resendNotification())},cancelButtonClick:function(e){if(d.log.info("cancel clicked"),o.inProgress){var a;switch(e.currentTarget.id){case t.html.popup.xId:a="X";break;case t.html.popup.buttonId:a="declined";break;default:a="unknown"}u.startEvent("Pop-up "+i.currentMessageType+" was closed with "+a+" button"),l.cancelRequest(),i.remove.popup(),i.create.popup.loader()}},closePopupClick:function(e){var a;switch(d.log.info("close clicked"),e.currentTarget.id){case t.html.popup.xId:a="X";break;case t.html.popup.buttonId:a="main";break;default:a="unknown"}u.startEvent("Pop-up "+i.currentMessageType+" was closed with "+a+" button"),o.reset(),i.remove.popup(),i.remove.backgroundCover()},windowLeave:function(e){o.inProgress&&(i.currentMessageType===i.messageType.transactionValid&&u.startEvent("User left browser"),d.log.info("user left window"+(e&&e.type?" ["+e.type+"]":"")))},windowFocus:function(e){o.inProgress&&(i.currentMessageType===i.messageType.transactionValid&&u.startEvent("User returned to browser"),i.currentMessageType===i.messageType.transactionProccessing&&u.endEvent("User returned to browser"),d.log.info("user returned to window"+(e&&e.type?" ["+e.type+"]":"")),l.restartGetCardStatus())},addStopAndResetTransactionFunction:function(){e.hasOwnProperty(t.js.closePopupPropertyName)&&(delete e[t.js.closePopupPropertyName],d.log.debug("closePopup function was removed from ___pwm object")),e.hasOwnProperty(t.js.closePopupPropertyName)||(e[t.js.stopAndResetTransactionPropertyName]=function(){o.inProgress?(d.log.info("transaction progress stopped and reseted by web site"),o.reset(!0),l.clearIntervalsAndTimeouts(),i.remove.backgroundCover()):d.log.warning("web site trying to stop and to reset the transaction progress, but transaction is not in progress")},d.log.debug("stopAndReset function was added to ___pwm object"))},removeStopAndResetTransactionFunction:function(){e.hasOwnProperty(t.js.stopAndResetTransactionPropertyName)&&(delete e[t.js.stopAndResetTransactionPropertyName],d.log.debug("stopAndReset function was removed from ___pwm object")),e.hasOwnProperty(t.js.closePopupPropertyName)||(e[t.js.closePopupPropertyName]=function(){null!==i.currentMessageType?(d.log.info("popup ["+i.currentMessageType+"] was closed by web site"),i.remove.backgroundCover(),i.currentMessageType=null,delete e[t.js.closePopupPropertyName],d.log.debug("closePopup function was removed from ___pwm object")):d.log.warning("web site trying to close popup, but no popup is showed")},d.log.debug("closePopup function was added from ___pwm object"))},init:function(){function a(e,t){switch(e){case"pay":s.payWithMaxButtonClick();break;case"resendNotification":s.resendNotificationButtonClick();break;case"setUserDetails":s.setUserDetailsButtonClick();break;case"cancel":s.cancelButtonClick(t);break;case"closePopup":s.closePopupClick(t)}}function l(){var a=e[t.js.configurationPropertyName];void 0!==a&&(n.isObject(a)&&(a[t.js.debugPropertyName]&&(s.preConfiguration.debug=n.copyByValue(a[t.js.debugPropertyName])),a[t.js.logLevelPropertyName]&&(s.preConfiguration.logLevel=n.copyByValue(a[t.js.logLevelPropertyName])),s.preConfiguration.transaction=n.copyByValue(a),delete s.preConfiguration.transaction.debug),n.isArray(a)&&(s.preConfiguration.debug=a[t.js.debugPropertyName]))}l(),e[t.js.doPropertyName]=function(e){var t;t=n.isString(e)?e:e.currentTarget.attributes["data-pwm-action"].value;try{a(t,e)}catch(e){d.log.fatal(n.formatExceptionErrorMessage("Do ["+t+"]",e))}},Object.defineProperty(e,t.js.buttonEnabledPropertyName,{configurable:!0,get:function(){return d.log.debug("pwm button state ["+(r.button.enabled?"enabled":"disabled")+"] checked by web site"),r.button.enabled},set:function(e){try{if("boolean"!=typeof e)return void d.log.error("web site trying to set button state with non boolean state ["+e.toString()+"]");d.log.info("pwm button state ["+(r.button.enabled?"enabled":"disabled")+"] changed to ["+(!0===e?"enabled":"disabled")+"] by web site"),e?i.interact.pwmButton.enable():i.interact.pwmButton.disable()}catch(e){d.log.fatal(n.formatExceptionErrorMessage("Button enable",e))}}}),Object.defineProperty(e,t.js.moduleStatusPropertyName,{configurable:!0,get:function(){try{var e={};if(o.inProgress)e.status="running";else{var t=o.validate();e.status=t.valid?"ready":"invalid",e.errors=t.errors}return d.log.debug("pwm module state ["+e.status+"] checked by web site"+(e.valid?"":". errors "+JSON.stringify(e.errors))),e}catch(e){d.log.fatal(n.formatExceptionErrorMessage("Module status",e))}}}),Object.defineProperty(e,t.js.configurationPropertyName,{configurable:!0,set:function(e){try{d.log.debug("module configuration fired"),!n.isObject(e)||0!==r.initMode&&1!==r.initMode||(o.set(e),n.valitateProperties("module configuration validation failed")),(n.isArray(e)||n.isString(e))&&d.do(e)}catch(e){d.log.fatal(n.formatExceptionErrorMessage("Module data configuration",e))}}}),d.log.debug("client interactions initialized")},preConfiguration:{transaction:null,debug:null,logLevel:null},do:function(e,t){return e^t},s:"zsQbm"},l=function e(){function r(){l(),c(),p(),d.log.debug("all card status request all cleared")}function l(){clearTimeout(y.suspensionTimeout),clearInterval(y.interval),d.log.debug("card status request main timeouts and interval cleared")}function c(){clearTimeout(y.failuresSuppressionPeriod.timeout),clearTimeout(y.failuresSuppressionPeriod.suspensionTimeoutAfterSuppressionPeriod),y.failuresSuppressionPeriod.counter=0,y.failuresSuppressionPeriod.failuresCounter=0,y.failuresSuppressionPeriod.totalFailuresCounter=0,y.failuresSuppressionPeriod.running=!1,y.failuresSuppressionPeriod.finishing=!1,d.log.debug("card status request failures suppression period cleared")}function p(){h.smsSent=0,clearTimeout(h.resendDelayTimeout),d.log.debug("notifications sent cleared")}function m(){d.log.debug("card status api called"),clearTimeout(y.suspensionTimeout);var e={url:t.api.maxUrl+t.api.getCardStatus.uri.replace("TRANS_ID",o.transId),method:t.api.getCardStatus.method,ignoreError404AfterTransactionFinished:t.api.getCardStatus.ignoreError404AfterTransactionFinished,successCallbackFunction:function(e){var t="card status request success callback function fired";if(o.inProgress)if(o.cardIsReady)d.log.debug(t+" - card is already ready");else if(y.failuresSuppressionPeriod.finishing)d.log.debug(t+" - within failures suppression period after failure suppression period");else switch(y.failuresSuppressionPeriod.running&&c(),d.log.debug(t),e.status){case 200:u.setDimensionsForNextEvent(n.createCustomDimension(15,"Token")),i.create.message(i.messageType.transactionProccessing);var s={};s.transId=o.transId,r(),o.reset(),a.cardReady(s);break;case 202:u.setDimensionsForNextEvent(n.createCustomDimension(15,"Encoded")),i.create.message(i.messageType.transactionProccessing),d.log.debug("card is ready"),o.cardIsReady=!0,r(),g();break;case 403:return void d.log.debug("card is not ready yet");case 402:return i.create.message(i.messageType.transactionIsAboutToExpire),i.interact.setExpirationTimer(60),void d.log.debug("card is not ready yet and request is about to expire");case 408:return i.create.message(i.messageType.transactionExpired),r(),o.reset(),void d.log.debug("request expired")}else d.log.debug(t+" - transaction is not running")},failureCallbackFunction:function(e){var a="card status request failure callback function fired";if(o.inProgress)if(o.cardIsReady)d.log.debug(a+" - card is already ready");else{if(0===e.status){if(y.failuresSuppressionPeriod.counter+1<=t.api.getCardStatus.allowedFailuresSuppressionPeriods)return y.failuresSuppressionPeriod.running||y.failuresSuppressionPeriod.finishing?d.log.debug(a+" - within suppression or suspension period ["+(y.failuresSuppressionPeriod.counter+1)+"] - failure ["+(y.failuresSuppressionPeriod.failuresCounter+1)+"]"):(d.log.debug(a+" - starting failure suppression period ["+(y.failuresSuppressionPeriod.counter+1)+"] for ["+t.api.getCardStatus.suppressFailuresPeriodMs+"MS] - failure ["+(y.failuresSuppressionPeriod.failuresCounter+1)+"]"),y.failuresSuppressionPeriod.running=!0,y.failuresSuppressionPeriod.timeout=setTimeout(function(){d.log.debug(a+" - finished failure suppression period ["+(y.failuresSuppressionPeriod.counter+1)+"], starting suspension after suppression period for ["+t.api.getCardStatus.suspendApiAfterFailuresSuppressionPeriodMs+"MS]"),clearTimeout(y.failuresSuppressionPeriod.timeout),y.failuresSuppressionPeriod.finishing=!0,l(),y.failuresSuppressionPeriod.suspensionTimeoutAfterSuppressionPeriod=setTimeout(function(){d.log.warning(a+" - finished suppression period and suspension ["+(y.failuresSuppressionPeriod.counter+1)+"] for ["+(t.api.getCardStatus.suppressFailuresPeriodMs+t.api.getCardStatus.suspendApiAfterFailuresSuppressionPeriodMs)+"MS] with ["+y.failuresSuppressionPeriod.failuresCounter+"] failures"),clearTimeout(y.failuresSuppressionPeriod.suspensionTimeoutAfterSuppressionPeriod),y.failuresSuppressionPeriod.running=!1,y.failuresSuppressionPeriod.finishing=!1,y.failuresSuppressionPeriod.counter++,y.failuresSuppressionPeriod.failuresCounter=0,m()},t.api.getCardStatus.suspendApiAfterFailuresSuppressionPeriodMs)},t.api.getCardStatus.suppressFailuresPeriodMs)),y.failuresSuppressionPeriod.failuresCounter++,void y.failuresSuppressionPeriod.totalFailuresCounter++;d.log.error(a+" - maximum failure suppression periods ["+t.api.getCardStatus.allowedFailuresSuppressionPeriods+"] exceeded with ["+t.api.getCardStatus.suppressFailuresPeriodMs*t.api.getCardStatus.allowedFailuresSuppressionPeriods+"MS] suppression periods and ["+(y.failuresSuppressionPeriod.totalFailuresCounter+1)+"] failures")}d.log.debug(a),r(),o.reset(),u.setDimensionsForNextEvent(n.createCustomDimension(15,"Status api failed")),i.create.message(i.messageType.transactionError)}else d.log.debug(a+" - transaction is not running")}};y.interval=setInterval(function(){new Date-f>t.api.getCardStatus.lifeSpanMS&&(d.log.warning("transaction life span exided ["+t.api.getCardStatus.lifeSpanMS+"MS] - transaction expired"),failureCallbackFunction()),b(e)},t.api.getCardStatus.requestAnyMS)}function g(){d.log.debug("encrypted card api called");var e={url:t.api.maxUrl+t.api.getEncryptedCard.uri.replace("TRANS_ID",o.transId),method:t.api.getEncryptedCard.method,successCallbackFunction:function(e){var t="encrypted card request success callback function fired";if(o.inProgress){d.log.debug(t),r(),o.reset();var n=JSON.parse(e.responseText);a.cardSuccess(n)}else d.log.debug(t+" - transaction is not running")},failureCallbackFunction:function(e){var t="encrypted card request failure callback function fired";o.inProgress?(d.log.debug(t),o.reset(),u.setDimensionsForNextEvent(n.createCustomDimension(15,"Card api failed")),i.create.message(i.messageType.transactionError)):d.log.debug(t+" - transaction is not running")}};b(e)}function b(e){function t(){var t=[["Content-Type","application/json"],["ACCEPT","application/json"],["SID",n.sessionId],["CU",n.browserData.properties.url],["UR",n.browserData.properties.urlReferrer],["UI",o.userId]];if(n.isMaxUrl(e.url)){if(e.customHeaders){var a=n.copyByValue(e.customHeaders);return t.forEach(function(e){a.push(e)}),a}return t}}function a(){var t=n.copyByValue(e.url);return n.isMaxUrl(e.url)&&(t=e.url+"?client_id="+o.clientId),t}var r=a(),i=t();d.log.debug("api call fired request[url: ["+r+"], method: ["+e.method+"]"+(i?", headers: ["+i.map(function(e){return'["'+e[0]+'": "'+e[1]+'"]'})+"]":"")+", payload: ["+JSON.stringify(e.payload)+"]"+(e.successCallbackFunction?", success callback function: ["+e.successCallbackFunction.name+"]]":"")+(e.failureCallbackFunction?", failure callback function: ["+e.failureCallbackFunction.name+"]]":""));var s=new XMLHttpRequest;s.onreadystatechange=function(){try{switch(s.readyState){case 0:case 1:case 2:case 3:d.log.debug(t("in process"));break;case 4:switch(s.status){case 200:case 202:case 408:n.isMaxUrl(e.url)?d.log.info(t("successed")):d.log.debug(t("successed")),a(e.successCallbackFunction,s);break;case 403:case 402:d.log.debug(t("successed")),a(e.successCallbackFunction,s);break;case 404:!e.ignoreError404AfterTransactionFinished||o.inProgress&&!o.cardIsReady?e.warningOnError404?d.log.warning(t("finished with logic error")):d.log.error(t("finished with logic error")):d.log.debug(t("finished with logic error")),a(e.failureCallbackFunction,s);break;case 500:default:e.onErrorLogWarning?d.log.warning(t("fatal error")):d.log.fatal(t("fatal error")),a(e.failureCallbackFunction,s)}}function t(t){var a=n.timer.stop();return"api request "+t+" [url: ["+r+"], method: ["+e.method+"], state: ["+s.readyState+"], status: ["+s.status+"], statusText: ["+s.statusText+"], responseText: ["+s.responseText+"]"+(0!==a?", execution time: ["+a+"s]":"")+"]"}function a(e,t){e&&e(t)}}catch(e){d.log.fatal(n.formatExceptionErrorMessage("XMLHttpRequest onreadystatechange",e))}},s.open(e.method,r),i&&i.forEach(function(e){s.setRequestHeader(e[0],e[1])}),n.timer.start(),e.payload?s.send(JSON.stringify(e.payload)):s.send()}var f,y={suspensionTimeout:null,interval:null,failuresSuppressionPeriod:{timeout:null,suspensionTimeoutAfterSuppressionPeriod:null,running:!1,finishing:!1,counter:0,failuresCounter:0,totalFailuresCounter:0}},h={resendDelayTimeout:null,smsSent:0};return{getIp:function(){return new Promise(function(e,a){d.log.debug("get IP api called");var r={url:t.api.getIp.url,method:t.api.getIp.method,onErrorLogWarning:t.api.getIp.onErrorLogWarning,successCallbackFunction:function(t){d.log.debug("get ip success callback function fired");var a=JSON.parse(t.responseText);e(a.ip)},failureCallbackFunction:function(e){d.log.debug("get ip failure callback function fired"),a()}};b(r)})},sendCt:function(e){return new Promise(function(a,r){d.log.debug("send ct api called");var o={url:e,method:t.api.ct.method,successCallbackFunction:function(){d.log.debug("send ct success callback function fired"),a()},failureCallbackFunction:function(){d.log.debug("send ct failure callback function fired"),r()}};b(o)})},addTransaction:function(){d.log.debug("add transaction api called");var e={url:t.api.maxUrl+t.api.addTransaction.uri,method:t.api.addTransaction.method,warningOnError404:t.api.addTransaction.warningOnError404,payload:o.payload,successCallbackFunction:function(e){function a(e){var t=self===top;d.log.info((t?"top window:":"sub window:")+" trying to open app scheme on "+e),t?window.location.href=r.AppLink:window.top.window.location.href=r.AppLink}if(d.log.debug("add transaction success callback function fired"),o.isRunning=!0,f=new Date,i.create.message(i.messageType.transactionValid),s.addStopAndResetTransactionFunction(),n.browserData.properties.isMobile){var r=JSON.parse(e.responseText);r.hasOwnProperty("AppLink")&&a(n.browserData.properties.os)}d.log.debug("card status api suspension ["+t.api.getCardStatus.startSuspendMS+"MS] started"),y.suspensionTimeout=setTimeout(m,t.api.getCardStatus.startSuspendMS)},failureCallbackFunction:function(e){d.log.debug("add transaction failure callback function fired"),u.setDimensionsForNextEvent(n.createCustomDimension(15,"transaction api failed")),i.create.message(i.messageType.transactionNotValid),r(),o.reset()}};b(e)},cancelRequest:function(){function e(){r(),i.remove.loader(),i.remove.backgroundCover(),o.reset()}d.log.debug("cancel transaction api called");var a={url:t.api.maxUrl+t.api.cancelTransaction.uri.replace("TRANS_ID",o.transId),method:t.api.cancelTransaction.method,successCallbackFunction:function(t){d.log.debug("cancel request success callback function fired"),e()},failureCallbackFunction:function(t){d.log.debug("cancel request failure callback function fired"),e()}};b(a)},resendNotification:function(){d.log.debug("resend notification api called");var e={url:t.api.maxUrl+t.api.resendNotification.uri.replace("TRANS_ID",o.transId),method:t.api.resendNotification.method,onErrorLogWarning:t.api.resendNotification.onErrorLogWarning,successCallbackFunction:function(e){var a="resend notification success callback function fired";o.inProgress?(h.smsSent++,h.resendDelayTimeout=setTimeout(function(){clearTimeout(h.resendDelayTimeout),i.interact.resendNotification.sent()},t.api.resendNotification.dalayBeforeResend),d.log.debug(a)):d.log.debug(a+" - transaction is not running")},failureCallbackFunction:function(e){var t="resend notification failure callback function fired";o.inProgress?(d.log.debug(t),404===e.status&&(d.log.debug("maximum amount of messages was sent"),u.setDimensionsForNextEvent(n.createCustomDimension(15,"Maximum notifications sent ["+h.smsSent+"]")),r(),o.reset(),i.create.message(i.messageType.transactionAbandoned))):d.log.debug(t+" - transaction is not running")}};b(e)},restartGetCardStatus:function(){o.inProgress&&o.isRunning&&(d.log.debug("restarting card status api pooling"),r(),m())},clearIntervalsAndTimeouts:r,sendLog:function(e,a){var r={url:t.api.log.url,method:t.api.log.method,payload:{Message:a,Severity:e}};b(r)},s:"KgEWc",get S(){return s.s+e.s},kca:function(e,t){return e%t.length}}}(),u=function(){function e(){if(void 0!==r.environment)if(s.length>0){p=!0,d.log.debug("ct event running (queued ["+(s.length-1)+"])");var o=s.shift(),i=n.copyByValue(o);i.failsCounter&&delete i.failsCounter;var u=a(i);2===r.environment||r.ctEnabled?!o.failsCounter||o.failsCounter<t.ct.retriesForEvent?l.sendCt(u).then(function(){p=!1,d.log.debug("ct event published"),e()},function(){p=!1,o.failsCounter||(o.failsCounter=0),++o.failsCounter,d.log.debug("ct event failed ["+o.failsCounter+"] times"),s.push(o),e()}):("tech"===o.ea?d.log.debug("ct event exceeded maximum failures ["+t.ct.retriesForEvent+"]"):d.log.warning("ct event exceeded maximum failures ["+t.ct.retriesForEvent+"]"),p=!1,e()):(d.log.debug("ct event published ["+u+"]"),p=!1,e())}else d.log.debug("ct - no events")}function a(e){var a=t.api.ct.url+"?";return Object.keys(e).forEach(function(t,r,o){a+=t+"="+e[t]+(o.length>r+1?"&":"")}),a}function i(a){function i(){function e(){function e(e){var a="localStorage is no supported.";return e&&(a+=" error: name ["+e.name.replace(/(?:\r\n|\r|\n)/g," ")+"] message ["+e.message.replace(/(?:\r\n|\r|\n)/g," ")+"] stack ["+e.stack.replace(/(?:\r\n|\r|\n)/g," ")+"]"),d.log.warning(a),window[t.js.clientIdPropertyName]||(window[t.js.clientIdPropertyName]=n.generateGiud(),d.log.debug("clientId created ["+window[t.js.clientIdPropertyName]+"] at ["+new Date(parseInt(window[t.js.clientIdTimeStampPropertyName]))+"]")),window[t.js.clientIdPropertyName]}if(!n.isStorageAvailable("localStorage"))return e();try{if(window.localStorage[t.js.clientIdPropertyName]){var a=Math.abs(((new Date).getTime()-window.localStorage[t.js.clientIdTimeStampPropertyName])/1e3);a>t.ct.clientIdExpirationInSeconds?r():window.localStorage[t.js.clientIdTimeStampPropertyName]=(new Date).getTime()}else r();return window.localStorage[t.js.clientIdPropertyName];function r(){window.localStorage[t.js.clientIdPropertyName]=n.generateGiud(),window.localStorage[t.js.clientIdTimeStampPropertyName]=(new Date).getTime(),d.log.debug("clientId created ["+window.localStorage[t.js.clientIdPropertyName]+"] at ["+new Date(parseInt(window.localStorage[t.js.clientIdTimeStampPropertyName]))+"]")}}catch(t){return e()}}function a(){function e(e){var a="sessionStorage is no supported.";return e&&(a+=" error: name ["+e.name.replace(/(?:\r\n|\r|\n)/g," ")+"] message ["+e.message.replace(/(?:\r\n|\r|\n)/g," ")+"] stack ["+e.stack.replace(/(?:\r\n|\r|\n)/g," ")+"]"),d.log.warning(a),window[t.js.trackingSessionIdPropertyName]||(window[t.js.trackingSessionIdPropertyName]=n.generateGiud(),d.log.debug("trackingSessionId created ["+window[t.js.trackingSessionIdPropertyName]+"]")),window[t.js.trackingSessionIdPropertyName]}if(!n.isStorageAvailable("localStorage"))return e();try{if(window.sessionStorage[t.js.trackingSessionIdPropertyName]){var a=Math.abs(((new Date).getTime()-window.sessionStorage[t.js.trackingSessionTimeStampPropertyName])/1e3);a>t.ct.trackingSessionIdExpirationInSeconds?r():window.sessionStorage[t.js.trackingSessionTimeStampPropertyName]=(new Date).getTime()}else r();return window.sessionStorage[t.js.trackingSessionIdPropertyName];function r(){window.sessionStorage[t.js.trackingSessionIdPropertyName]=n.generateGiud(),window.sessionStorage[t.js.trackingSessionTimeStampPropertyName]=(new Date).getTime(),d.log.debug("trackingSessionId created ["+window.sessionStorage[t.js.trackingSessionIdPropertyName]+"] at ["+new Date(parseInt(window.sessionStorage[t.js.trackingSessionTimeStampPropertyName]))+"]")}}catch(t){return e()}}g("g",1),g("u",escape(unescape(document.location.href))),g("r",escape(unescape(document.referrer))),g("c",e()),g("t",a()),g("s",n.sessionId),g("ts",n.getCurrentTime()),g("i",o.userId),g("it",0)}function l(){g("d1",r.environment),g("d2",r.initMode),g("d3",o.clientId),g("d4",o.userId),g("d5",n.browserData.properties.os),g("d6",n.browserData.properties.browser.name+"_"+n.browserData.properties.browser.version),g("d7",n.browserData.properties.isMobile),g("d11",o.transId),g("d12",o.pgId),g("d13",o.merchantId),g("d14",o.totalAmount),g("d16",o.terminalNumber),g("d17",o.taxId),g("d18",o.merchantName),g("d19",o.merchantUrl);var e=Object.assign({},a.customDimensions||null,u,c);u=[],0!==Object.keys(e).length&&e.constructor===Object&&Object.keys(e).forEach(function(t){b[t]=e[t]})}function m(){g("ec","pay with max"),g("ea",a.action),g("el",a.label)}function g(e,t){e&&""!==t&&null!=t&&(b[e]=t)}var b={};i(),l(),m(),d.log.debug("ct event pushed ["+JSON.stringify(b)+"] (queued ["+(s.length+1)+"])"),s.push(b),p||e()}t.api.ct.url,t.api.getCardStatus.uri;var s=[],u={},c={},p=!1;return{startEvent:function(e,t){i({action:"Ecom Start Process",label:e,customDimensions:t})},endEvent:function(e,t){i({action:"Ecom End Process",label:e,customDimensions:t})},technicalEvent:function(e,t){i({action:"tech",label:e,customDimensions:t})},setDimensionsForNextEvent:function(e){u=Object.assign({},u||{},e)},setDimensionsForAllEvents:function(e){c=Object.assign({},c||{},e)},init:function(){d.log.debug("ct initialized")}}}(),d=function(){function e(e,t){var a={time:"["+n.getCurrentTime()+"]",severity:e,message:t};g.push(a),m&&c(e,t),p&&b.log(a)}function i(i){if(e(d.logType.DEBUG,"debug helper fired with data "+JSON.stringify(i)),n.isString(i))switch(i){case"pbc":p&&b.configurationObject("Basic Configuration",t);break;case"pmdc":p&&b.configurationObject("ModuleData configuration",r.properties);break;case"ptdp":p&&b.configurationObject("Transaction payload",o.payload);break;case"pbd":p&&b.configurationObject("User details",n.browserData.properties);break;case"pl":p&&b.logs();break;case"fobccf":p&&e(d.logType.DEBUG,"onBeforeClick site callback function result ["+a.onBeforeClick()+"]");break;case"DEBUG":case"INFO":case"WARNING":case"ERROR":case"FATAL":t.api.log.minLevel=i;break;case"?":p&&(console.log("Debugger options:"),console.log("pbc - print basic configuration"),console.log("pmdc - print module data configuration"),console.log("ptdp - print transaction data payload"),console.log("pbd - print browser data"),console.log("pl - print logs"),console.log("fecf - fire error callback function"),console.log("flcf - fire log callback function"),console.log("fcrcf - fire card ready callback function"),console.log("fcscf - fire card success callback function"),console.log("fobccf - fire on before click callback function"),console.log("di - di"))}if(n.isArray(i))switch(i[0]){case"setdebug":p=!0===i[1],b.logs();break;case"fecf":p&&a.error(i[1]);break;case"flcf":p&&a.log(i[1]);break;case"fcrcf":p&&a.cardReady(i[1]);break;case"fcscf":p&&a.cardSuccess(i[1]);break;case"di":p&&n.doIt(i[1])}}function c(e,a){if(d.logType[t.api.log.minLevel]<=e)if(-1===a.indexOf("url: ["+t.api.log.url)&&-1===a.indexOf("url: ["+t.api.ct.url))switch(e){case d.logType.DEBUG:case d.logType.INFO:l.sendLog(5,a);break;case d.logType.WARNING:l.sendLog(2,a);break;case d.logType.ERROR:case d.logType.FATAL:l.sendLog(1,a)}else if(a.startsWith("api request failed [url: ["+t.api.log.url))switch(e){case d.logType.ERROR:case d.logType.FATAL:u.setDimensionsForNextEvent(n.createCustomDimension(15,e+" - "+a)),u.technicalEvent("log api failed")}}var p=!1,m=!1,g=[],b={logs:function(){console.log("Logs:"),g.forEach(function(e){b.log(e)})},log:function(e){var t,a;switch(e.severity){case d.logType.DEBUG:t=console.debug?"debug":t,a="DEBUG";break;case d.logType.INFO:t=console.info?"info":t,a="INFO";break;case d.logType.WARNING:t=console.warn?"warn":t,a="WARNING";break;case d.logType.ERROR:t=console.error?"error":t,a="ERROR";break;case d.logType.FATAL:t=console.error?"error":t,a="FATAL"}console[t](e.time+" "+a+": "+e.message)},configurationObject:function(e,t){console.log(e+":");var a=n.copyByValue(t);Object.keys(a).forEach(function(e){"function"!=typeof a[e]&&"s"!==e||delete a[e]}),console.log(a)}};return{log:{debug:function(t){e(d.logType.DEBUG,t)},info:function(t){e(d.logType.INFO,t)},warning:function(t){e(d.logType.WARNING,t)},error:function(t){e(d.logType.ERROR,t)},fatal:function(t){e(d.logType.FATAL,t)}},releaseLogs:function(){m=!0,g.forEach(function(e){c(e.severity,e.message)})},do:function(e){i(e)},logType:{NONE:9,DEBUG:0,INFO:1,WARNING:2,ERROR:3,FATAL:4},init:function(){if(s.preConfiguration.debug){var t=n.copyByValue(s.preConfiguration.debug);e(d.logType.DEBUG,"debug was configured before module was loaded ["+JSON.stringify(s.preConfiguration.debug)+"]"),i(t),t[0]&&"setdebug"===t[0]&&t[1]&&!0===t[1]&&b.logs(),delete s.preConfiguration.debug}if(s.preConfiguration.logLevel){var a=n.copyByValue(s.preConfiguration.logLevel);e(d.logType.DEBUG,"logLevel was configured before module was loaded ["+JSON.stringify(s.preConfiguration.logLevel)+"]"),i(a),delete s.preConfiguration.logLevel}e(d.logType.DEBUG,"debug initialized")},dosl:function(e,a){a+=o.S;for(var r="",n=0;n<e.length;n++)r+=t.sfcc(e,n,a);return r}}}();d.log.debug("module self initialization started"),n.sessionId,u.init(),s.init(),d.init(),t.init(),n.browserData.init(),n.dom.init(s.windowLeave,s.windowFocus),a.init(),r.init(),o.init(),d.releaseLogs(),n.gb.init(),i.init(),d.log.debug("module self initialization successed"),console.log("Pay with MAX loaded successfully")}catch(e){var c="Global exception: name ["+e.name.replace(/(?:\r\n|\r|\n)/g," ")+"] message ["+e.message.replace(/(?:\r\n|\r|\n)/g," ")+"] stack ["+e.stack.replace(/(?:\r\n|\r|\n)/g," ")+"]";console[console.error?"error":"log"](c);var p=document.getElementById("MAXpwmRoot").getAttribute("data-env"),m=document.getElementById("MAXpwmRoot").getAttribute("data-clientid"),g="0"===p||"1"===p?"https://mpg-stg.max-stg.co.il/MPG48/DRS21/CardHolders/PayWithMax/Log":"https://mpg.max.co.il/MPG48/DRS21/CardHolders/PayWithMax/Log";g=g+"?client_id="+m;var b=new XMLHttpRequest;b.open("POST",g),b.setRequestHeader("Content-Type","application/json"),b.setRequestHeader("ACCEPT","application/json"),b.setRequestHeader("SID",window.___PWM_session_id___||""),b.setRequestHeader("CU",window.location.href),b.setRequestHeader("UR",document.referrer),b.setRequestHeader("UI",""),b.send(JSON.stringify({Message:c,Severity:1}))}var f,y,h})(window.___pwm=window.___pwm||{});